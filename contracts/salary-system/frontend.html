<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decentralized Salary System - Real Testnet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            background: #10b981;
            color: white;
            margin-left: 10px;
        }

        .badge-testnet {
            background: #f59e0b;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f4ff;
            border-radius: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ef4444;
        }

        .status-dot.connected {
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button[onclick*="copy"],
        button[onclick*="window.open"] {
            transition: all 0.3s ease;
        }

        button[onclick*="copy"]:hover {
            background: #5a67d8 !important;
            transform: translateY(-1px);
        }

        button[onclick*="window.open"]:hover {
            background: #059669 !important;
            transform: translateY(-1px);
        }

        input:disabled {
            background: #f3f4f6;
            cursor: not-allowed;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .info-box h3 {
            color: #667eea;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .info-box p {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .code-box {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9em;
            word-break: break-all;
            margin: 10px 0;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .transaction-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .transaction-card:hover {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .tx-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        .tx-type {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            background: #667eea;
            color: white;
        }

        .tx-time {
            color: #888;
            font-size: 0.85em;
        }

        .tx-hash {
            font-family: monospace;
            font-size: 0.85em;
            color: #667eea;
            word-break: break-all;
            margin: 5px 0;
        }

        .tx-details {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #f3f4f6;
            font-size: 0.9em;
            color: #666;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíº Decentralized Salary System</h1>
            <span class="badge">Monthly Payments</span>
            <span class="badge badge-testnet">üåê Testnet</span>
            <p style="margin-top: 10px;">Real Blockchain Transactions via Freighter</p>
        </div>

        <!-- Alert Messages -->
        <div id="alertSuccess" class="alert alert-success"></div>
        <div id="alertError" class="alert alert-error"></div>
        <div id="alertInfo" class="alert alert-info"></div>

        <!-- Freighter Connection -->
        <div class="card">
            <h2>üîê Wallet Connection</h2>
            
            <!-- Connection Status -->
            <div class="connection-status">
                <div class="status-dot" id="statusDot"></div>
                <div>
                    <strong>Status:</strong> <span id="connectionStatus">Not Connected</span>
                </div>
            </div>
            
            <div id="connectedInfo" style="display: none; margin-bottom: 15px;">
                <div class="code-box">
                    <strong>Your Address:</strong><br>
                    <span id="walletAddress"></span>
                </div>
                <button onclick="disconnectWallet()" style="margin-top: 10px; background: #ef4444; padding: 10px 20px; font-size: 0.9em;">
                    üîå Disconnect Wallet
                </button>
            </div>

            <!-- Option 1: Freighter Wallet -->
            <div style="margin-bottom: 20px;">
                <h3 style="color: #667eea; font-size: 1.1em; margin-bottom: 10px;">Option 1: Connect via Freighter ü¶ä</h3>
                <button onclick="connectFreighter()" id="connectBtn">Connect Freighter Wallet</button>
                <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                    Automatically connects to your Freighter browser extension
                </p>
            </div>

            <!-- OR Divider -->
            <div style="text-align: center; margin: 30px 0; position: relative;">
                <div style="height: 1px; background: #e5e7eb;"></div>
                <span style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: white; padding: 0 15px; color: #888; font-weight: 600;">OR</span>
            </div>

            <!-- Option 2: Manual Address Input -->
            <div>
                <h3 style="color: #667eea; font-size: 1.1em; margin-bottom: 10px;">Option 2: Enter Address Manually ‚úçÔ∏è</h3>
                <div class="form-group">
                    <label for="manualAddress">Stellar Address (starts with G...):</label>
                    <input 
                        type="text" 
                        id="manualAddress" 
                        placeholder="GXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
                        style="font-family: monospace; font-size: 0.9em;"
                    >
                </div>
                <button onclick="connectManually()">Connect with This Address</button>
                <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                    Use this if you don't have Freighter installed or prefer manual entry
                </p>
            </div>

            <!-- Quick Address Buttons -->
            <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                <h4 style="color: #0369a1; margin-bottom: 10px;">üîë Quick Connect (Known Accounts):</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <button onclick="quickConnect('GBPAKDYZKKXENIPOXGYCB2ZEVRQKK2JEBLPJ3CHK7MRMBZLHNPTGJAZE')" style="padding: 8px 12px; font-size: 0.85em; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üë§ Alice (Admin)
                    </button>
                    <button onclick="quickConnect('GCBGNIA2KZ5C5Q3X737DEPBOUB56F5VRVSRBW5YX6CR6UH5KTYIYOYVA')" style="padding: 8px 12px; font-size: 0.85em; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üë§ Employee 1
                    </button>
                    <button onclick="quickConnect('GCBDACPLLDVEC67IO6V7DCOVZFUH4DP5UTSO5CPHIB46F4VRN7PWGAT3')" style="padding: 8px 12px; font-size: 0.85em; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üë§ Employee 2
                    </button>
                    <button onclick="quickConnect('GBXCEWXR6J4DRLYCWCUBHBSKBFOQ3T4AJM5MXKCE6V3TAUJNBG6LDTNP')" style="padding: 8px 12px; font-size: 0.85em; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üë§ Employee 3
                    </button>
                </div>
                <p style="color: #666; font-size: 0.85em; margin-top: 10px;">
                    Click to quickly connect as a known account from this system
                </p>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <strong>‚ö†Ô∏è Freighter Setup:</strong>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Install Freighter: <a href="https://www.freighter.app/" target="_blank" style="color: #d97706;">freighter.app</a></li>
                    <li>Switch to <strong>TESTNET</strong> in Freighter settings</li>
                    <li>Get testnet XLM from <a href="https://laboratory.stellar.org/#account-creator?network=test" target="_blank" style="color: #d97706;">Friendbot</a></li>
                </ul>
            </div>
        </div>

        <!-- Contract Info -->
        <div class="card">
            <h2>üìã Contract Information</h2>
            <div class="info-grid">
                <div class="info-box">
                    <h3>Contract Status</h3>
                    <p style="font-size: 1.2em;">‚úÖ Live on Testnet</p>
                </div>
                <div class="info-box">
                    <h3>Network</h3>
                    <p style="font-size: 1.2em;">Stellar Testnet</p>
                </div>
            </div>
            <div class="code-box">
                <strong>Contract ID:</strong><br>
                CDXYPMRADZYRBUI2GNYICZBS7H6GJLX7BI3DI4HCUG2YISRR3NTLL4R4
            </div>
            <div class="code-box">
                <strong>Token Address (Native XLM):</strong><br>
                CDLZFC3SYJYDZT7K67VZ75HPJVIEUVNIXF47ZG2FB2RMQQVU2HHGCYSC
            </div>
            <a href="https://stellar.expert/explorer/testnet/contract/CDXYPMRADZYRBUI2GNYICZBS7H6GJLX7BI3DI4HCUG2YISRR3NTLL4R4" target="_blank" style="display: inline-block; margin-top: 15px; color: #667eea; font-weight: 600;">
                View on Stellar Expert ‚Üí
            </a>
        </div>

        <!-- Treasury & Sustainability -->
        <div class="card">
            <h2>üí∞ Treasury & Sustainability Analysis</h2>
            <p style="color: #666; margin-bottom: 15px;">
                Check treasury balance and calculate how many years the funds will last
            </p>
            
            <div style="margin-bottom: 20px;">
                <button onclick="loadTreasuryInfo()" id="loadTreasuryBtn">
                    üìä Load Treasury Information
                </button>
            </div>

            <div id="treasuryInfo" style="margin-top: 20px;">
                <p style="color: #888; text-align: center; padding: 20px;">
                    Click "Load Treasury Information" to fetch balance and sustainability data
                </p>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                <h3 style="color: #0369a1; margin-bottom: 15px;">üí° Understanding Sustainability</h3>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                    The sustainability calculation considers:
                </p>
                <ul style="margin-left: 20px; color: #666; font-size: 0.9em;">
                    <li>Current treasury balance</li>
                    <li>All active employees' salaries</li>
                    <li>5% annual salary increments (compound)</li>
                    <li>12 monthly payments per year</li>
                </ul>
                <p style="color: #666; font-size: 0.9em; margin-top: 15px;">
                    <strong>Example:</strong> If you have 3 employees (6 XLM/month) and 300 XLM in treasury, 
                    it will calculate year-by-year with increments until funds run out.
                </p>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <strong>üìñ CLI Commands:</strong>
                <div class="code-box" style="background: #1f2937; color: #10b981; margin-top: 10px;">
# Check treasury balance
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- get_treasury_balance

# Calculate sustainability years
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- calculate_sustainability_years
                </div>
            </div>
        </div>

        <!-- Employee Management -->
        <div class="card">
            <h2>üë• Employee Management</h2>
            <p style="color: #666; margin-bottom: 15px;">
                Current employees in the salary system
            </p>
            
            <div style="margin-bottom: 20px;">
                <button onclick="loadEmployees()" id="loadEmpBtn">
                    üë§ Load All Employees
                </button>
            </div>

            <div id="employeesList" style="margin-top: 20px;">
                <p style="color: #888; text-align: center; padding: 20px;">
                    Click "Load All Employees" to fetch employee list from the blockchain
                </p>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                <h3 style="color: #0369a1; margin-bottom: 15px;">‚ûï Add New Employee (Live)</h3>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                    Add employees directly to the blockchain via backend server:
                </p>
                
                <div id="addEmployeeAlert" style="display: none; padding: 10px; margin-bottom: 15px; border-radius: 8px;"></div>
                
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div class="form-group">
                        <label for="empName">Employee Name *</label>
                        <input type="text" id="empName" placeholder="e.g., john_doe" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                    </div>
                    
                    <div class="form-group">
                        <label for="empAddress">Stellar Address *</label>
                        <input type="text" id="empAddress" placeholder="Starts with G... (56 characters)" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                        <small style="color: #666;">Must be a valid Stellar testnet address</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="empSalary">Monthly Salary (XLM) *</label>
                        <input type="number" id="empSalary" placeholder="e.g., 10" min="0.1" step="0.1" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                        <small style="color: #666;">Monthly salary in XLM (e.g., 10 XLM/month)</small>
                    </div>
                    
                    <button onclick="addEmployeeToBlockchain()" id="addEmpBtn" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: 600; cursor: pointer;">
                        ‚ûï Add Employee to Blockchain
                    </button>
                    
                    <div id="addEmployeeStatus" style="margin-top: 15px; padding: 10px; display: none; border-radius: 8px;"></div>
                </div>
            </div>

            <!-- Stop/Resume Employee Salary -->
            <div style="margin-top: 30px; padding: 20px; background: #fef2f2; border-radius: 8px; border-left: 4px solid #ef4444;">
                <h3 style="color: #991b1b; margin-bottom: 15px;">‚öôÔ∏è Manage Employee Salary (Admin Only)</h3>
                <p style="color: #7f1d1d; font-size: 0.9em; margin-bottom: 15px;">
                    Stop or resume salary payments for an employee:
                </p>
                
                <div id="manageSalaryAlert" style="display: none; padding: 10px; margin-bottom: 15px; border-radius: 8px;"></div>
                
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div class="form-group">
                        <label for="manageEmpAddress">Employee Stellar Address *</label>
                        <input type="text" id="manageEmpAddress" placeholder="Starts with G... (56 characters)" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                        <small style="color: #666;">The employee whose salary you want to manage</small>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <button onclick="stopEmployeeSalary()" id="stopSalaryBtn" style="padding: 15px; background: linear-gradient(135deg, #ef4444 0%, #991b1b 100%); color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer;">
                            ‚è∏Ô∏è Stop Salary
                        </button>
                        
                        <button onclick="resumeEmployeeSalary()" id="resumeSalaryBtn" style="padding: 15px; background: linear-gradient(135deg, #10b981 0%, #047857 100%); color: white; border: none; border-radius: 8px; font-size: 1em; font-weight: 600; cursor: pointer;">
                            ‚ñ∂Ô∏è Resume Salary
                        </button>
                    </div>
                    
                    <div id="manageSalaryStatus" style="margin-top: 15px; padding: 10px; display: none; border-radius: 8px;"></div>
                </div>
            </div>
        </div>

        <!-- Salary Operations -->
        <div class="card">
            <h2>üí∞ Salary Operations</h2>
            
            <div style="margin-bottom: 30px; padding: 20px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <h3 style="color: #92400e; margin-bottom: 15px;">üí∏ Pay All Employees (Admin Only)</h3>
                <p style="color: #78350f; margin-bottom: 15px; font-weight: 500;">
                    ‚ö†Ô∏è This will pay monthly salaries to ALL active employees at once!
                </p>
                
                <div id="payAllAlert" style="display: none; padding: 10px; margin-bottom: 15px; border-radius: 8px;"></div>
                
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="margin-bottom: 15px; padding: 15px; background: #fef3c7; border-radius: 8px;">
                        <p style="margin: 0; color: #92400e; font-size: 0.95em;">
                            <strong>üìã This action will:</strong><br>
                            ‚Ä¢ Get all registered employees<br>
                            ‚Ä¢ Pay each employee their monthly salary<br>
                            ‚Ä¢ Deduct from treasury automatically<br>
                            ‚Ä¢ Show detailed results for each payment
                        </p>
                    </div>
                    
                    <button onclick="payAllEmployees()" id="payAllBtn" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #f59e0b 0%, #dc2626 100%); color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                        üí∏ Pay All Employees Now
                    </button>
                    
                    <div id="payAllStatus" style="margin-top: 15px; padding: 10px; display: none; border-radius: 8px; max-height: 400px; overflow-y: auto;"></div>
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">Pay Single Employee</h3>
                <p style="color: #666; margin-bottom: 10px;">
                    Pay a specific employee's monthly salary:
                </p>
                <div class="code-box" style="background: #1f2937; color: #10b981;">
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- pay_salary \
  --employee_address EMPLOYEE_ADDRESS
                </div>
            </div>

            <div style="margin-bottom: 30px; padding: 20px; background: #dbeafe; border-radius: 8px; border-left: 4px solid #3b82f6;">
                <h3 style="color: #1e40af; margin-bottom: 15px;">üí∞ Fund Treasury (Admin Only)</h3>
                <p style="color: #1e3a8a; margin-bottom: 15px;">
                    Add XLM to the contract treasury to ensure payroll funds:
                </p>
                
                <div id="fundTreasuryAlert" style="display: none; padding: 10px; margin-bottom: 15px; border-radius: 8px;"></div>
                
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div class="form-group">
                        <label for="fundAmount">Amount (XLM) *</label>
                        <input type="number" id="fundAmount" placeholder="e.g., 100" min="0.1" step="0.1" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                        <small style="color: #666;">Amount to add to treasury in XLM</small>
                    </div>
                    
                    <button onclick="fundTreasury()" id="fundTreasuryBtn" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #3b82f6 0%, #1e40af 100%); color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: 600; cursor: pointer;">
                        üí∞ Fund Treasury
                    </button>
                    
                    <div id="fundTreasuryStatus" style="margin-top: 15px; padding: 10px; display: none; border-radius: 8px;"></div>
                </div>
            </div>
        </div>

        <!-- Employee Self-Service -->
        <div class="card" style="border-left: 4px solid #10b981;">
            <h2>üéâ Employee Self-Service (NEW!)</h2>
            <p style="color: #666; margin-bottom: 20px;">
                <strong>Employees can now claim their own salaries!</strong> No need to wait for admin - withdraw your monthly payment anytime.
            </p>

            <div style="padding: 20px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981; margin-bottom: 25px;">
                <h3 style="color: #059669; margin-bottom: 15px;">‚ú® How It Works</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div>
                        <div style="font-size: 2em; margin-bottom: 5px;">üîê</div>
                        <strong style="color: #047857;">Secure</strong>
                        <p style="color: #666; font-size: 0.9em; margin-top: 5px;">Only you can claim your salary</p>
                    </div>
                    <div>
                        <div style="font-size: 2em; margin-bottom: 5px;">‚è±Ô∏è</div>
                        <strong style="color: #047857;">Flexible</strong>
                        <p style="color: #666; font-size: 0.9em; margin-top: 5px;">Claim anytime during the month</p>
                    </div>
                    <div>
                        <div style="font-size: 2em; margin-bottom: 5px;">‚úÖ</div>
                        <strong style="color: #047857;">Protected</strong>
                        <p style="color: #666; font-size: 0.9em; margin-top: 5px;">One claim per month limit</p>
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 30px; padding: 20px; background: #ecfdf5; border-radius: 8px; border-left: 4px solid #10b981;">
                <h3 style="color: #059669; margin-bottom: 15px;">üí∞ Claim Your Salary (Live!)</h3>
                <p style="color: #047857; margin-bottom: 15px; font-weight: 500;">
                    <strong>‚ú® NEW!</strong> Employees can now claim their salary directly from the browser!
                </p>
                
                <div id="claimSalaryAlert" style="display: none; padding: 10px; margin-bottom: 15px; border-radius: 8px;"></div>
                
                <div style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                    <div style="margin-bottom: 15px; padding: 15px; background: #ecfdf5; border-radius: 8px;">
                        <p style="margin: 0; color: #047857; font-size: 0.95em;">
                            <strong>üìã Before claiming:</strong><br>
                            ‚Ä¢ Make sure you are a registered employee<br>
                            ‚Ä¢ You haven't claimed this month yet<br>
                            ‚Ä¢ Treasury has sufficient funds<br>
                            ‚Ä¢ Enter your employee name (optional) for better tracking
                        </p>
                    </div>
                    
                    <div class="form-group">
                        <label for="claimEmpName">Your Name (Optional)</label>
                        <input type="text" id="claimEmpName" placeholder="e.g., john_doe" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                        <small style="color: #666;">For display purposes only</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="claimEmpAddress">Your Stellar Address *</label>
                        <input type="text" id="claimEmpAddress" placeholder="Starts with G... (56 characters)" style="width: 100%; padding: 10px; border: 2px solid #ddd; border-radius: 8px; font-size: 1em;">
                        <small style="color: #666;">The address where you receive your salary</small>
                    </div>
                    
                    <button onclick="claimMySalary()" id="claimSalaryBtn" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #10b981 0%, #047857 100%); color: white; border: none; border-radius: 8px; font-size: 1.1em; font-weight: 600; cursor: pointer;">
                        üí∞ Claim My Salary Now
                    </button>
                    
                    <div id="claimSalaryStatus" style="margin-top: 15px; padding: 10px; display: none; border-radius: 8px;"></div>
                </div>
            </div>

            <div style="padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b; margin-bottom: 25px;">
                <strong style="color: #92400e;">‚ö†Ô∏è Important Rules:</strong>
                <ul style="margin-left: 20px; margin-top: 10px; color: #78350f;">
                    <li>You can only claim <strong>once per month</strong></li>
                    <li>Must be an <strong>active employee</strong></li>
                    <li>Treasury must have <strong>sufficient balance</strong></li>
                    <li>Your salary includes <strong>5% annual increment</strong></li>
                </ul>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #059669; margin-bottom: 15px;">üÜö Admin Payment vs Self-Service</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                        <thead>
                            <tr style="background: #f3f4f6;">
                                <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb;">Feature</th>
                                <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb;">Admin Payment</th>
                                <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb;">Self-Service ‚ú®</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Who initiates</strong></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Admin (alice)</td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Employee themselves</td>
                            </tr>
                            <tr style="background: #f9fafb;">
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Authentication</strong></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Admin account</td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Employee account</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Function</strong></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><code>pay_salary</code></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><code>claim_salary</code></td>
                            </tr>
                            <tr style="background: #f9fafb;">
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Use case</strong></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Bulk payments</td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Individual withdrawal</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Control</strong></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Centralized</td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong style="color: #059669;">Decentralized üéâ</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div style="padding: 20px; background: #eff6ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                <h3 style="color: #1e40af; margin-bottom: 15px;">üìö Learn More</h3>
                <p style="color: #666; margin-bottom: 10px;">
                    üìö For complete documentation of all features:
                </p>
                <ul style="margin-left: 20px; color: #1e40af;">
                    <li><code>FEATURES_GUIDE.md</code> - Complete guide for all 6 features (Admin + Employee)</li>
                    <li>Includes: Add Employee, Pay All, Fund Treasury, Stop/Resume Salary, Claim Salary</li>
                    <li>Also includes: API documentation, troubleshooting, and best practices</li>
                </ul>
            </div>
        </div>

        <!-- Instructions -->
        <div class="card">
            <h2>üìñ How to Use (CLI Required)</h2>
            <p style="color: #666; margin-bottom: 15px;">
                This contract requires the <strong>Stellar CLI</strong> to interact with. The frontend shows information but cannot sign transactions directly.
            </p>
            
            <h3 style="color: #667eea; margin-top: 20px; margin-bottom: 10px;">1Ô∏è‚É£ Fund the Treasury</h3>
            <div class="code-box" style="background: #1f2937; color: #10b981;">
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- fund_treasury \
  --from $(stellar keys address alice) \
  --amount 1000000000
            </div>

            <h3 style="color: #667eea; margin-top: 20px; margin-bottom: 10px;">2Ô∏è‚É£ Add an Employee</h3>
            <div class="code-box" style="background: #1f2937; color: #10b981;">
# Create employee account
stellar keys generate employee1 --network testnet --fund

# Add to contract
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- add_employee \
  --employee_address $(stellar keys address employee1) \
  --name "John Doe" \
  --base_salary 120000000
            </div>

            <h3 style="color: #667eea; margin-top: 20px; margin-bottom: 10px;">3Ô∏è‚É£ Pay Monthly Salary</h3>
            <div class="code-box" style="background: #1f2937; color: #10b981;">
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- pay_salary \
  --employee_address $(stellar keys address employee1)
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #d1fae5; border-radius: 8px; border: 2px solid #10b981;">
                <strong>üí° Better Way:</strong> Use the <strong>"Claim My Salary"</strong> button above instead! No terminal commands needed - just enter your address and click the button. üéâ
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <h2>‚ö° Quick Links</h2>
            <div style="display: grid; gap: 10px;">
                <a href="https://laboratory.stellar.org/#account-creator?network=test" target="_blank" style="display: block; padding: 15px; background: #f0f4ff; border-radius: 8px; color: #667eea; text-decoration: none; font-weight: 600;">
                    ü™ô Get Testnet XLM (Friendbot)
                </a>
                <a href="https://stellar.expert/explorer/testnet/contract/CDXYPMRADZYRBUI2GNYICZBS7H6GJLX7BI3DI4HCUG2YISRR3NTLL4R4" target="_blank" style="display: block; padding: 15px; background: #f0f4ff; border-radius: 8px; color: #667eea; text-decoration: none; font-weight: 600;">
                    üîç View Contract on Stellar Expert
                </a>
                <a href="https://www.freighter.app/" target="_blank" style="display: block; padding: 15px; background: #f0f4ff; border-radius: 8px; color: #667eea; text-decoration: none; font-weight: 600;">
                    ü¶ä Install Freighter Wallet
                </a>
            </div>
        </div>
    </div>

    <script>
        // Contract Configuration
        const CONTRACT_ID = 'CDXYPMRADZYRBUI2GNYICZBS7H6GJLX7BI3DI4HCUG2YISRR3NTLL4R4';
        const TOKEN_ADDRESS = 'CDLZFC3SYJYDZT7K67VZ75HPJVIEUVNIXF47ZG2FB2RMQQVU2HHGCYSC';
        const NETWORK_PASSPHRASE = 'Test SDF Network ; September 2015';
        
        let walletAddress = null;
        let freighter = null;

        // Connect to Freighter
        async function connectFreighter() {
            try {
                // Check if Freighter is installed
                if (!window.freighterApi) {
                    showAlert('error', 'Freighter wallet not found! Please install it from freighter.app or use manual address entry below.');
                    return;
                }

                freighter = window.freighterApi;

                // Request access
                const isAllowed = await freighter.isAllowed();
                if (!isAllowed) {
                    await freighter.setAllowed();
                }

                // Get public key
                walletAddress = await freighter.getPublicKey();
                
                // Check network
                const network = await freighter.getNetwork();
                if (network !== 'TESTNET') {
                    showAlert('error', 'Please switch Freighter to TESTNET in settings!');
                    return;
                }

                // Update UI
                updateConnectionUI(walletAddress, 'Freighter');

            } catch (error) {
                console.error('Freighter connection error:', error);
                showAlert('error', 'Failed to connect: ' + error.message);
            }
        }

        // Connect manually with address
        function connectManually() {
            const address = document.getElementById('manualAddress').value.trim();
            
            // Validate address format
            if (!address) {
                showAlert('error', 'Please enter a Stellar address');
                return;
            }
            
            if (!address.startsWith('G') || address.length !== 56) {
                showAlert('error', 'Invalid Stellar address. Must start with G and be 56 characters long.');
                return;
            }

            walletAddress = address;
            updateConnectionUI(address, 'Manual');
        }

        // Quick connect with predefined address
        function quickConnect(address) {
            walletAddress = address;
            document.getElementById('manualAddress').value = address;
            updateConnectionUI(address, 'Quick Connect');
        }

        // Update connection UI
        function updateConnectionUI(address, method) {
            document.getElementById('connectionStatus').textContent = `Connected via ${method}`;
            document.getElementById('statusDot').classList.add('connected');
            document.getElementById('walletAddress').textContent = address;
            document.getElementById('connectedInfo').style.display = 'block';
            
            // Disable connect buttons
            document.getElementById('connectBtn').textContent = 'Connected ‚úì';
            document.getElementById('connectBtn').disabled = true;

            showAlert('success', `Connected! Address: ${address.substring(0, 10)}...${address.substring(50)}`);
        }

        // Disconnect wallet
        function disconnectWallet() {
            walletAddress = null;
            document.getElementById('connectionStatus').textContent = 'Not Connected';
            document.getElementById('statusDot').classList.remove('connected');
            document.getElementById('connectedInfo').style.display = 'none';
            document.getElementById('connectBtn').textContent = 'Connect Freighter Wallet';
            document.getElementById('connectBtn').disabled = false;
            document.getElementById('manualAddress').value = '';
            showAlert('info', 'Wallet disconnected');
        }

        // Helper Functions
        function showAlert(type, message) {
            const alertMap = {
                'success': 'alertSuccess',
                'error': 'alertError',
                'info': 'alertInfo'
            };

            const alertId = alertMap[type];
            const alertEl = document.getElementById(alertId);
            alertEl.textContent = message;
            alertEl.classList.add('show');

            setTimeout(() => {
                alertEl.classList.remove('show');
            }, 5000);
        }

        // Load Employees List
        async function loadEmployees() {
            const btn = document.getElementById('loadEmpBtn');
            const listEl = document.getElementById('employeesList');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Loading...';
            listEl.innerHTML = '<p style="text-align: center; color: #888;">Fetching employees from blockchain...</p>';

            try {
                // Fetch employees from backend API
                const response = await fetch('http://localhost:3000/api/employees');
                const data = await response.json();
                
                if (!data.success) {
                    throw new Error(data.error || 'Failed to fetch employees');
                }

                const employeeAddresses = data.employees;

                if (employeeAddresses.length === 0) {
                    listEl.innerHTML = '<p style="text-align: center; color: #888;">No employees found. Add employees using the "Add New Employee" button above!</p>';
                    btn.disabled = false;
                    btn.innerHTML = 'üîÑ Refresh Employee List';
                    return;
                }

                // Remove duplicates - keep only unique addresses
                const uniqueAddresses = [...new Set(employeeAddresses)];
                console.log(`Total employees: ${employeeAddresses.length}, Unique: ${uniqueAddresses.length}`);

                // Fetch details for each unique employee
                const employeeDetails = await Promise.all(
                    uniqueAddresses.map(async (address) => {
                        try {
                            const detailResponse = await fetch(`http://localhost:3000/api/employee/${address}`);
                            const detailData = await detailResponse.json();
                            return detailData.success ? detailData.employee : null;
                        } catch (err) {
                            console.error(`Error fetching details for ${address}:`, err);
                            return null;
                        }
                    })
                );

                // Filter out nulls and inactive employees
                const employees = employeeDetails.filter(e => e !== null && e.is_active);

                // Display employees
                let totalMonthly = 0;
                let html = '';
                
                for (const emp of employees) {
                    const monthlyXLM = (emp.base_salary / 10000000 / 12).toFixed(2);
                    const annualXLM = (emp.base_salary / 10000000).toFixed(2);
                    totalMonthly += parseFloat(monthlyXLM);

                    html += `
                        <div class="transaction-card">
                            <div class="tx-header">
                                <span class="tx-type">üë§ ${emp.name.toUpperCase()}</span>
                                <span class="tx-time">${monthlyXLM} XLM/month</span>
                            </div>
                            <div>
                                <strong>Address:</strong><br>
                                <a href="https://stellar.expert/explorer/testnet/account/${emp.address}" 
                                   target="_blank" 
                                   class="tx-hash">${emp.address}</a>
                            </div>
                            <div class="tx-details">
                                <div><strong>Annual Salary:</strong> ${annualXLM} XLM</div>
                                <div><strong>Monthly Salary:</strong> ${monthlyXLM} XLM</div>
                                <div><strong>Status:</strong> ${emp.is_active ? '‚úÖ Active' : '‚è∏Ô∏è Paused'}</div>
                                <div><strong>Start Date:</strong> ${emp.start_year}/${emp.start_month}</div>
                                <div><strong>Last Payment:</strong> ${emp.last_payment_year}/${emp.last_payment_month}</div>
                            </div>
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e5e7eb;">
                                <button onclick="copyToClipboard('${emp.address}')" style="padding: 5px 10px; font-size: 0.85em; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    üìã Copy Address
                                </button>
                                <button onclick="window.open('https://stellar.expert/explorer/testnet/account/${emp.address}', '_blank')" style="padding: 5px 10px; font-size: 0.85em; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 5px;">
                                    üîç View Details
                                </button>
                            </div>
                        </div>
                    `;
                }

                // Prepend summary
                const summaryHtml = `
                    <div style="margin-bottom: 15px; padding: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        <strong>üìä Employee Summary</strong><br>
                        <div style="margin-top: 10px; display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                            <div><strong>Total Employees:</strong> ${employees.length}</div>
                            <div><strong>Active:</strong> ${employees.filter(e => e.is_active).length}</div>
                            <div><strong>Monthly Payroll:</strong> ${totalMonthly.toFixed(2)} XLM</div>
                            <div><strong>Annual Payroll:</strong> ${(totalMonthly * 12).toFixed(2)} XLM</div>
                        </div>
                    </div>
                `;

                listEl.innerHTML = summaryHtml + html;
                showAlert('success', `‚úÖ Loaded ${employees.length} employees from blockchain`);

            } catch (error) {
                console.error('Error loading employees:', error);
                showAlert('error', `‚ùå Failed to load employees: ${error.message}`);
                listEl.innerHTML = `
                    <div style="padding: 20px; background: #fee2e2; border-radius: 8px; color: #991b1b; border: 1px solid #fecaca;">
                        <strong>‚ö†Ô∏è Error Loading Employees</strong><br>
                        <p>${error.message}</p>
                        <p style="margin-top: 10px;">
                            <button onclick="loadEmployees()" style="padding: 8px 16px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                üîÑ Try Again
                            </button>
                        </p>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üîÑ Refresh Employee List';
            }
        }

        // Copy to clipboard helper
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showAlert('success', 'Address copied to clipboard!');
            }).catch(err => {
                showAlert('error', 'Failed to copy: ' + err.message);
            });
        }

        // Load Treasury Information
        async function loadTreasuryInfo() {
            const btn = document.getElementById('loadTreasuryBtn');
            const infoEl = document.getElementById('treasuryInfo');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Loading...';
            infoEl.innerHTML = '<p style="text-align: center; color: #888;">Fetching treasury data from blockchain...</p>';

            try {
                // Fetch treasury balance from backend API
                const treasuryResponse = await fetch('http://localhost:3000/api/treasury-balance');
                const treasuryData = await treasuryResponse.json();
                
                if (!treasuryData.success) {
                    throw new Error(treasuryData.error || 'Failed to fetch treasury balance');
                }
                
                const treasuryBalance = parseFloat(treasuryData.balanceXLM);
                
                // Fetch employees to calculate payroll
                const employeesResponse = await fetch('http://localhost:3000/api/employees');
                const employeesData = await employeesResponse.json();
                
                if (!employeesData.success) {
                    throw new Error(employeesData.error || 'Failed to fetch employees');
                }
                
                // Fetch details for each employee to calculate total payroll
                let monthlyPayroll = 0;
                for (const address of employeesData.employees) {
                    try {
                        const detailResponse = await fetch(`http://localhost:3000/api/employee/${address}`);
                        const detailData = await detailResponse.json();
                        if (detailData.success && detailData.employee.is_active) {
                            const monthlyXLM = detailData.employee.base_salary / 10000000 / 12;
                            monthlyPayroll += monthlyXLM;
                        }
                    } catch (err) {
                        console.error(`Error fetching employee ${address}:`, err);
                    }
                }
                
                const annualPayroll = monthlyPayroll * 12;
                
                // Calculate actual sustainability with 5% compound increments
                let balance = treasuryBalance;
                let years = 0;
                let currentAnnualCost = annualPayroll;
                
                while (balance >= currentAnnualCost) {
                    balance -= currentAnnualCost;
                    years++;
                    currentAnnualCost = currentAnnualCost * 1.05; // 5% increment
                    if (years > 100) break; // Safety limit
                }
                
                const sustainabilityYears = years;
                
                // Calculate additional metrics
                const simpleYears = Math.floor(treasuryBalance / annualPayroll);
                const currentMonth = new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                
                // Determine status based on sustainability
                let statusEmoji = '‚úÖ';
                let statusText = 'Healthy';
                let statusColor = '#8b5cf6';
                
                if (sustainabilityYears >= 5) {
                    statusEmoji = '‚úÖ';
                    statusText = 'Excellent';
                    statusColor = '#10b981';
                } else if (sustainabilityYears >= 2) {
                    statusEmoji = '‚úÖ';
                    statusText = 'Good';
                    statusColor = '#3b82f6';
                } else if (sustainabilityYears >= 1) {
                    statusEmoji = '‚ö†Ô∏è';
                    statusText = 'Fair';
                    statusColor = '#f59e0b';
                } else {
                    statusEmoji = '‚ùå';
                    statusText = 'Critical';
                    statusColor = '#ef4444';
                }

                let html = `
                    <div class="info-grid" style="margin-bottom: 20px;">
                        <div class="info-box" style="background: linear-gradient(135deg, #10b98115 0%, #059f6915 100%); border-left: 4px solid #10b981;">
                            <h3 style="color: #10b981;">Treasury Balance</h3>
                            <p style="color: #059669;">${treasuryBalance} XLM</p>
                            <small style="color: #666; font-size: 0.8em;">‚âà ${(treasuryBalance * 10000000).toLocaleString()} stroops</small>
                        </div>
                        <div class="info-box" style="background: linear-gradient(135deg, #3b82f615 0%, #2563eb15 100%); border-left: 4px solid #3b82f6;">
                            <h3 style="color: #3b82f6;">Monthly Payroll</h3>
                            <p style="color: #2563eb;">${monthlyPayroll} XLM</p>
                            <small style="color: #666; font-size: 0.8em;">Annual: ${annualPayroll} XLM</small>
                        </div>
                        <div class="info-box" style="background: linear-gradient(135deg, #f59e0b15 0%, #d9770615 100%); border-left: 4px solid #f59e0b;">
                            <h3 style="color: #f59e0b;">Sustainability</h3>
                            <p style="color: #d97706;">${sustainabilityYears} Years</p>
                            <small style="color: #666; font-size: 0.8em;">With 5% annual increments</small>
                        </div>
                        <div class="info-box" style="background: linear-gradient(135deg, #8b5cf615 0%, #7c3aed15 100%); border-left: 4px solid ${statusColor};">
                            <h3 style="color: ${statusColor};">Status</h3>
                            <p style="color: ${statusColor}; font-size: 1.5em;">${statusEmoji} ${statusText}</p>
                            <small style="color: #666; font-size: 0.8em;">As of ${currentMonth}</small>
                        </div>
                    </div>

                    <div style="padding: 20px; background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-radius: 10px; border-left: 4px solid #667eea; margin-bottom: 20px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üìà Detailed Analysis</h3>
                        <div style="display: grid; gap: 10px; color: #333;">
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                <span><strong>Current Balance:</strong></span>
                                <span>${treasuryBalance} XLM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                <span><strong>Monthly Expenses:</strong></span>
                                <span>${monthlyPayroll} XLM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                <span><strong>Annual Expenses (Year 1):</strong></span>
                                <span>${annualPayroll} XLM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                <span><strong>Annual Increment Rate:</strong></span>
                                <span>5% (compound)</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                <span><strong>Simple Calculation:</strong></span>
                                <span>${simpleYears} years (without increments)</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: #10b981; color: white; border-radius: 6px; font-weight: bold;">
                                <span><strong>With 5% Increments:</strong></span>
                                <span>${sustainabilityYears} YEARS üéØ</span>
                            </div>
                        </div>
                    </div>

                    <div style="padding: 15px; background: #dbeafe; border-radius: 8px; border-left: 4px solid #3b82f6; margin-bottom: 20px;">
                        <h4 style="color: #1e40af; margin-bottom: 10px;">üí° What This Means:</h4>
                        <ul style="margin-left: 20px; color: #1e3a8a; line-height: 1.8;">
                            <li>With <strong>5% annual salary increments</strong>, your treasury can sustain all employees for <strong>${sustainabilityYears} years</strong></li>
                            <li>Year 1 expenses: ${annualPayroll} XLM ‚Üí Year 2 expenses: ${(annualPayroll * 1.05).toFixed(2)} XLM ‚Üí And so on...</li>
                            <li>The smart contract calculates year-by-year until treasury is depleted</li>
                            <li>To extend sustainability: Fund more XLM or reduce payroll</li>
                        </ul>
                    </div>

                    <div style="padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <h4 style="color: #92400e; margin-bottom: 10px;">‚ö†Ô∏è Recommendations:</h4>
                        <ul style="margin-left: 20px; color: #78350f; line-height: 1.8;">
                            <li><strong>Maintain buffer:</strong> Keep at least 2 years of payroll in treasury</li>
                            <li><strong>Regular funding:</strong> Add funds before sustainability drops below 1 year</li>
                            <li><strong>Monitor growth:</strong> As you add employees, recalculate sustainability</li>
                            <li><strong>Current status:</strong> ${sustainabilityYears} years - ${sustainabilityYears >= 5 ? "Excellent funding! ‚úÖ" : sustainabilityYears >= 2 ? "Good, but consider adding funds soon" : "Add more funds to improve sustainability ‚ö†Ô∏è"}</li>
                        </ul>
                    </div>
                `;

                infoEl.innerHTML = html;
                showAlert('success', `‚úÖ Treasury data loaded from blockchain! Balance: ${treasuryBalance.toFixed(2)} XLM`);

            } catch (error) {
                console.error('Error loading treasury info:', error);
                showAlert('error', `‚ùå Failed to load treasury: ${error.message}`);
                infoEl.innerHTML = `
                    <div style="padding: 20px; background: #fee2e2; border-radius: 8px; color: #991b1b; border: 1px solid #fecaca;">
                        <strong>‚ö†Ô∏è Error Loading Treasury Data</strong><br>
                        <p>${error.message}</p>
                        <p style="margin-top: 10px;">
                            <button onclick="loadTreasuryInfo()" style="padding: 8px 16px; background: #dc2626; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                üîÑ Try Again
                            </button>
                        </p>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üîÑ Refresh Treasury Info';
            }
        }

        // Load Transaction History
        async function loadTransactions() {
            const btn = document.getElementById('loadTxBtn');
            const listEl = document.getElementById('transactionsList');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Loading...';
            listEl.innerHTML = '<p style="text-align: center; color: #888;">Fetching transactions from blockchain...</p>';

            try {
                // Fetch alice's transactions (admin who makes all contract calls)
                const ALICE_ADDRESS = 'GBPAKDYZKKXENIPOXGYCB2ZEVRQKK2JEBLPJ3CHK7MRMBZLHNPTGJAZE';
                const response = await fetch(
                    `https://horizon-testnet.stellar.org/accounts/${ALICE_ADDRESS}/transactions?limit=20&order=desc`
                );

                if (!response.ok) {
                    throw new Error('Failed to fetch transactions');
                }

                const data = await response.json();
                const transactions = data._embedded.records;

                if (transactions.length === 0) {
                    listEl.innerHTML = '<p style="text-align: center; color: #888;">No transactions found yet.</p>';
                    return;
                }

                // Fetch operation details for each transaction
                let html = '<div style="margin-bottom: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">';
                html += `<strong>üìä Found ${transactions.length} transactions</strong><br>`;
                html += '<span style="color: #666; font-size: 0.9em;">Recent activity from admin account (alice)</span>';
                html += '</div>';
                
                for (const tx of transactions) {
                    const date = new Date(tx.created_at);
                    const timeAgo = getTimeAgo(date);
                    
                    // Fetch operations to determine transaction type
                    let txType = 'CONTRACT CALL';
                    let txIcon = 'üìù';
                    let txColor = '#667eea';
                    
                    try {
                        const opsResponse = await fetch(tx._links.operations.href);
                        if (opsResponse.ok) {
                            const opsData = await opsResponse.json();
                            const ops = opsData._embedded.records;
                            
                            // Analyze operations to determine type
                            if (ops.some(op => op.type === 'invoke_host_function')) {
                                const memo = tx.memo || '';
                                if (memo.includes('fund') || ops[0].function?.includes('fund')) {
                                    txType = 'üí∞ FUND TREASURY';
                                    txIcon = 'üí∞';
                                    txColor = '#10b981';
                                } else if (memo.includes('add_employee') || ops[0].function?.includes('add')) {
                                    txType = '‚ûï ADD EMPLOYEE';
                                    txIcon = 'üë§';
                                    txColor = '#0ea5e9';
                                } else if (memo.includes('pay') || ops[0].function?.includes('pay')) {
                                    txType = 'üí∏ PAY SALARY';
                                    txIcon = 'üí∏';
                                    txColor = '#f59e0b';
                                } else if (memo.includes('initialize')) {
                                    txType = 'üöÄ INITIALIZE';
                                    txIcon = 'üöÄ';
                                    txColor = '#8b5cf6';
                                }
                            }
                        }
                    } catch (e) {
                        // If we can't fetch operations, just use default type
                    }
                    
                    html += `
                        <div class="transaction-card" style="border-left: 4px solid ${txColor};">
                            <div class="tx-header">
                                <span class="tx-type" style="background: ${txColor}20; color: ${txColor};">
                                    ${txIcon} ${txType}
                                </span>
                                <span class="tx-time">${timeAgo}</span>
                            </div>
                            <div style="margin: 15px 0;">
                                <strong>Transaction Hash:</strong><br>
                                <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                                    <a href="https://stellar.expert/explorer/testnet/tx/${tx.hash}" 
                                       target="_blank" 
                                       class="tx-hash">${tx.hash.substring(0, 32)}...</a>
                                    <button onclick="copyToClipboard('${tx.hash}')" 
                                            style="padding: 5px 10px; font-size: 0.8em; background: #f3f4f6; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                        üìã Copy
                                    </button>
                                </div>
                            </div>
                            <div class="tx-details">
                                <div><strong>üìÖ Date:</strong> ${date.toLocaleString()}</div>
                                <div><strong>‚öôÔ∏è Operations:</strong> ${tx.operation_count}</div>
                                <div><strong>üíé Fee:</strong> ${(parseFloat(tx.fee_charged) / 10000000).toFixed(7)} XLM</div>
                                <div><strong>‚úÖ Status:</strong> ${tx.successful ? '<span style="color: #10b981;">‚úÖ Successful</span>' : '<span style="color: #ef4444;">‚ùå Failed</span>'}</div>
                            </div>
                        </div>
                    `;
                }

                listEl.innerHTML = html;
                showAlert('success', `Loaded ${transactions.length} transactions from admin account`);

            } catch (error) {
                console.error('Error loading transactions:', error);
                listEl.innerHTML = `
                    <div style="padding: 20px; background: #fee; border-radius: 8px; color: #c00;">
                        <strong>Error:</strong> ${error.message}<br><br>
                        Try viewing transactions directly on 
                        <a href="https://stellar.expert/explorer/testnet/contract/${CONTRACT_ID}" 
                           target="_blank" 
                           style="color: #667eea;">Stellar Expert</a>
                    </div>
                `;
                showAlert('error', 'Failed to load transactions: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üîÑ Reload Transactions';
            }
        }

        // Get human-readable time ago
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            const intervals = {
                year: 31536000,
                month: 2592000,
                week: 604800,
                day: 86400,
                hour: 3600,
                minute: 60,
                second: 1
            };

            for (const [unit, secondsInUnit] of Object.entries(intervals)) {
                const interval = Math.floor(seconds / secondsInUnit);
                if (interval >= 1) {
                    return `${interval} ${unit}${interval !== 1 ? 's' : ''} ago`;
                }
            }
            
            return 'Just now';
        }

        // Add Employee to Blockchain via Backend
        async function addEmployeeToBlockchain() {
            const btn = document.getElementById('addEmpBtn');
            const statusEl = document.getElementById('addEmployeeStatus');
            const alertEl = document.getElementById('addEmployeeAlert');
            
            // Get form values
            const name = document.getElementById('empName').value.trim();
            const address = document.getElementById('empAddress').value.trim();
            const monthlyXLM = parseFloat(document.getElementById('empSalary').value);
            
            // Hide previous alerts
            alertEl.style.display = 'none';
            statusEl.style.display = 'none';
            
            // Validation
            if (!name || !address || !monthlyXLM) {
                alertEl.textContent = '‚ùå Please fill in all fields!';
                alertEl.style.background = '#fee2e2';
                alertEl.style.color = '#991b1b';
                alertEl.style.display = 'block';
                return;
            }
            
            if (!address.startsWith('G') || address.length !== 56) {
                alertEl.textContent = '‚ùå Invalid Stellar address! Must start with G and be 56 characters.';
                alertEl.style.background = '#fee2e2';
                alertEl.style.color = '#991b1b';
                alertEl.style.display = 'block';
                return;
            }
            
            if (monthlyXLM <= 0 || isNaN(monthlyXLM)) {
                alertEl.textContent = '‚ùå Salary must be a positive number!';
                alertEl.style.background = '#fee2e2';
                alertEl.style.color = '#991b1b';
                alertEl.style.display = 'block';
                return;
            }
            
            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Adding to blockchain...';
            
            statusEl.textContent = '‚è≥ Sending transaction to blockchain...';
            statusEl.style.background = '#fef3c7';
            statusEl.style.color = '#92400e';
            statusEl.style.display = 'block';
            
            try {
                // Call backend API
                const response = await fetch('http://localhost:3000/api/add-employee', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        name: name,
                        address: address,
                        monthlyXLM: monthlyXLM
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Success!
                    statusEl.textContent = `‚úÖ Success! ${name} has been added to the blockchain!`;
                    statusEl.style.background = '#d1fae5';
                    statusEl.style.color = '#065f46';
                    statusEl.style.display = 'block';
                    
                    showAlert('success', `Employee ${name} added successfully with ${monthlyXLM} XLM/month salary!`);
                    
                    // Clear form
                    document.getElementById('empName').value = '';
                    document.getElementById('empAddress').value = '';
                    document.getElementById('empSalary').value = '';
                    
                    // Refresh employee list after 2 seconds
                    setTimeout(() => {
                        loadEmployees();
                    }, 2000);
                    
                } else {
                    // Error from backend
                    statusEl.textContent = `‚ùå Error: ${result.message || result.error}`;
                    statusEl.style.background = '#fee2e2';
                    statusEl.style.color = '#991b1b';
                    statusEl.style.display = 'block';
                    
                    showAlert('error', result.message || 'Failed to add employee');
                }
                
            } catch (error) {
                console.error('Error:', error);
                statusEl.textContent = `‚ùå Connection Error: ${error.message}. Make sure the backend server is running!`;
                statusEl.style.background = '#fee2e2';
                statusEl.style.color = '#991b1b';
                statusEl.style.display = 'block';
                
                showAlert('error', 'Backend server not running! Start it with: node backend_server.js');
            } finally {
                // Re-enable button
                btn.disabled = false;
                btn.innerHTML = '‚ûï Add Employee to Blockchain';
            }
        }

        // Pay All Employees
        async function payAllEmployees() {
            const btn = document.getElementById('payAllBtn');
            const statusEl = document.getElementById('payAllStatus');
            const alertEl = document.getElementById('payAllAlert');
            
            // Hide previous alerts
            alertEl.style.display = 'none';
            statusEl.style.display = 'none';
            
            // Confirm action
            const confirmed = confirm(
                '‚ö†Ô∏è WARNING: This will pay ALL employees!\n\n' +
                'Are you sure you want to proceed?\n\n' +
                '‚Ä¢ This will deduct funds from the treasury\n' +
                '‚Ä¢ Each employee will receive their monthly salary\n' +
                '‚Ä¢ This action cannot be undone'
            );
            
            if (!confirmed) {
                return;
            }
            
            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Processing payments...';
            
            statusEl.innerHTML = '<p style="text-align: center; color: #92400e; padding: 20px;">‚è≥ Fetching employees and processing payments...<br><small>This may take a few moments</small></p>';
            statusEl.style.background = '#fef3c7';
            statusEl.style.display = 'block';
            
            try {
                // Call backend API
                const response = await fetch('http://localhost:3000/api/pay-all-salaries', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Success!
                    let html = '<div style="background: #d1fae5; padding: 15px; border-radius: 8px; margin-bottom: 10px;">';
                    html += `<h4 style="color: #065f46; margin: 0 0 10px 0;">‚úÖ ${result.message}</h4>`;
                    html += `<p style="color: #047857; margin: 0;"><strong>Summary:</strong></p>`;
                    html += `<ul style="color: #047857; margin: 10px 0 0 20px;">`;
                    html += `<li>Total Employees: ${result.summary.total}</li>`;
                    html += `<li>Successful Payments: ${result.summary.successful}</li>`;
                    html += `<li>Failed Payments: ${result.summary.failed}</li>`;
                    html += `</ul></div>`;
                    
                    // Show detailed results
                    if (result.details && result.details.length > 0) {
                        html += '<div style="margin-top: 15px;"><h4 style="color: #667eea; margin-bottom: 10px;">Payment Details:</h4>';
                        
                        for (const detail of result.details) {
                            const bgColor = detail.status === 'success' ? '#d1fae5' : '#fee2e2';
                            const textColor = detail.status === 'success' ? '#065f46' : '#991b1b';
                            const icon = detail.status === 'success' ? '‚úÖ' : '‚ùå';
                            
                            html += `<div style="background: ${bgColor}; padding: 10px; border-radius: 6px; margin-bottom: 8px; font-size: 0.9em;">`;
                            html += `<p style="color: ${textColor}; margin: 0;">${icon} <strong>${detail.address.substring(0, 15)}...${detail.address.substring(50)}</strong></p>`;
                            if (detail.error) {
                                html += `<p style="color: ${textColor}; margin: 5px 0 0 0; font-size: 0.85em;">${detail.error}</p>`;
                            }
                            html += `</div>`;
                        }
                        html += '</div>';
                    }
                    
                    statusEl.innerHTML = html;
                    statusEl.style.background = 'white';
                    statusEl.style.border = '2px solid #10b981';
                    
                    showAlert('success', `Successfully paid ${result.summary.successful} employees!`);
                    
                    // Refresh treasury info after 3 seconds
                    setTimeout(() => {
                        loadTreasuryInfo();
                        loadEmployees();
                    }, 3000);
                    
                } else {
                    // Error from backend
                    statusEl.innerHTML = `<div style="background: #fee2e2; padding: 15px; border-radius: 8px;"><p style="color: #991b1b; margin: 0;"><strong>‚ùå Error:</strong> ${result.message || result.error}</p></div>`;
                    statusEl.style.background = 'white';
                    statusEl.style.display = 'block';
                    
                    showAlert('error', result.message || 'Failed to pay employees');
                }
                
            } catch (error) {
                console.error('Error:', error);
                statusEl.innerHTML = `<div style="background: #fee2e2; padding: 15px; border-radius: 8px;"><p style="color: #991b1b; margin: 0;"><strong>‚ùå Connection Error:</strong> ${error.message}<br><small>Make sure the backend server is running!</small></p></div>`;
                statusEl.style.background = 'white';
                statusEl.style.display = 'block';
                
                showAlert('error', 'Backend server not running! Start it with: node backend_server.js');
            } finally {
                // Re-enable button
                btn.disabled = false;
                btn.innerHTML = 'üí∏ Pay All Employees Now';
            }
        }

        // Fund Treasury
        async function fundTreasury() {
            const btn = document.getElementById('fundTreasuryBtn');
            const statusEl = document.getElementById('fundTreasuryStatus');
            const alertEl = document.getElementById('fundTreasuryAlert');
            
            // Get form value
            const amountXLM = parseFloat(document.getElementById('fundAmount').value);
            
            // Hide previous alerts
            alertEl.style.display = 'none';
            statusEl.style.display = 'none';
            
            // Validation
            if (!amountXLM || amountXLM <= 0 || isNaN(amountXLM)) {
                alertEl.textContent = '‚ùå Please enter a valid amount greater than 0!';
                alertEl.style.background = '#fee2e2';
                alertEl.style.color = '#991b1b';
                alertEl.style.display = 'block';
                return;
            }
            
            // Confirm action
            const confirmed = confirm(
                `üí∞ Fund Treasury\n\n` +
                `You are about to add ${amountXLM} XLM to the treasury.\n\n` +
                `Are you sure you want to proceed?`
            );
            
            if (!confirmed) {
                return;
            }
            
            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Processing...';
            
            statusEl.textContent = '‚è≥ Funding treasury...';
            statusEl.style.background = '#fef3c7';
            statusEl.style.color = '#92400e';
            statusEl.style.display = 'block';
            
            try {
                const response = await fetch('http://localhost:3000/api/fund-treasury', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ amountXLM: amountXLM })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusEl.textContent = `‚úÖ Success! Treasury funded with ${amountXLM} XLM!`;
                    statusEl.style.background = '#d1fae5';
                    statusEl.style.color = '#065f46';
                    statusEl.style.display = 'block';
                    
                    showAlert('success', `Treasury funded with ${amountXLM} XLM!`);
                    
                    // Clear form
                    document.getElementById('fundAmount').value = '';
                    
                    // Refresh treasury after 2 seconds
                    setTimeout(() => {
                        loadTreasuryInfo();
                    }, 2000);
                    
                } else {
                    statusEl.textContent = `‚ùå Error: ${result.message || result.error}`;
                    statusEl.style.background = '#fee2e2';
                    statusEl.style.color = '#991b1b';
                    statusEl.style.display = 'block';
                    
                    showAlert('error', result.message || 'Failed to fund treasury');
                }
                
            } catch (error) {
                console.error('Error:', error);
                statusEl.textContent = `‚ùå Connection Error: ${error.message}. Make sure the backend server is running!`;
                statusEl.style.background = '#fee2e2';
                statusEl.style.color = '#991b1b';
                statusEl.style.display = 'block';
                
                showAlert('error', 'Backend server not running!');
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üí∞ Fund Treasury';
            }
        }

        // Stop Employee Salary
        async function stopEmployeeSalary() {
            const btn = document.getElementById('stopSalaryBtn');
            const statusEl = document.getElementById('manageSalaryStatus');
            const alertEl = document.getElementById('manageSalaryAlert');
            
            const address = document.getElementById('manageEmpAddress').value.trim();
            
            // Hide previous alerts
            alertEl.style.display = 'none';
            statusEl.style.display = 'none';
            
            // Validation
            if (!address) {
                alertEl.textContent = '‚ùå Please enter an employee address!';
                alertEl.style.background = '#fee2e2';
                alertEl.style.color = '#991b1b';
                alertEl.style.display = 'block';
                return;
            }
            
            if (!address.startsWith('G') || address.length !== 56) {
                alertEl.textContent = '‚ùå Invalid Stellar address! Must start with G and be 56 characters.';
                alertEl.style.background = '#fee2e2';
                alertEl.style.color = '#991b1b';
                alertEl.style.display = 'block';
                return;
            }
            
            // Confirm action
            const confirmed = confirm(
                `‚è∏Ô∏è Stop Salary\n\n` +
                `You are about to STOP salary for:\n${address}\n\n` +
                `The employee will not receive future payments until you resume.\n\n` +
                `Are you sure?`
            );
            
            if (!confirmed) {
                return;
            }
            
            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Stopping...';
            
            statusEl.textContent = '‚è≥ Stopping salary...';
            statusEl.style.background = '#fef3c7';
            statusEl.style.color = '#92400e';
            statusEl.style.display = 'block';
            
            try {
                const response = await fetch('http://localhost:3000/api/stop-employee-salary', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ employeeAddress: address })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusEl.textContent = `‚úÖ Salary stopped for ${address.substring(0, 15)}...`;
                    statusEl.style.background = '#d1fae5';
                    statusEl.style.color = '#065f46';
                    statusEl.style.display = 'block';
                    
                    showAlert('success', 'Employee salary stopped successfully!');
                    
                    // Clear form
                    document.getElementById('manageEmpAddress').value = '';
                    
                } else {
                    statusEl.textContent = `‚ùå Error: ${result.message || result.error}`;
                    statusEl.style.background = '#fee2e2';
                    statusEl.style.color = '#991b1b';
                    statusEl.style.display = 'block';
                    
                    showAlert('error', result.message || 'Failed to stop salary');
                }
                
            } catch (error) {
                console.error('Error:', error);
                statusEl.textContent = `‚ùå Connection Error: ${error.message}. Make sure the backend server is running!`;
                statusEl.style.background = '#fee2e2';
                statusEl.style.color = '#991b1b';
                statusEl.style.display = 'block';
                
                showAlert('error', 'Backend server not running!');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '‚è∏Ô∏è Stop Salary';
            }
        }

        // Resume Employee Salary
        async function resumeEmployeeSalary() {
            const btn = document.getElementById('resumeSalaryBtn');
            const statusEl = document.getElementById('manageSalaryStatus');
            const alertEl = document.getElementById('manageSalaryAlert');
            
            const address = document.getElementById('manageEmpAddress').value.trim();
            
            // Hide previous alerts
            alertEl.style.display = 'none';
            statusEl.style.display = 'none';
            
            // Validation
            if (!address) {
                alertEl.textContent = '‚ùå Please enter an employee address!';
                alertEl.style.background = '#fee2e2';
                alertEl.style.color = '#991b1b';
                alertEl.style.display = 'block';
                return;
            }
            
            if (!address.startsWith('G') || address.length !== 56) {
                alertEl.textContent = '‚ùå Invalid Stellar address! Must start with G and be 56 characters.';
                alertEl.style.background = '#fee2e2';
                alertEl.style.color = '#991b1b';
                alertEl.style.display = 'block';
                return;
            }
            
            // Confirm action
            const confirmed = confirm(
                `‚ñ∂Ô∏è Resume Salary\n\n` +
                `You are about to RESUME salary for:\n${address}\n\n` +
                `The employee will receive future salary payments again.\n\n` +
                `Are you sure?`
            );
            
            if (!confirmed) {
                return;
            }
            
            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Resuming...';
            
            statusEl.textContent = '‚è≥ Resuming salary...';
            statusEl.style.background = '#fef3c7';
            statusEl.style.color = '#92400e';
            statusEl.style.display = 'block';
            
            try {
                const response = await fetch('http://localhost:3000/api/resume-employee-salary', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ employeeAddress: address })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusEl.textContent = `‚úÖ Salary resumed for ${address.substring(0, 15)}...`;
                    statusEl.style.background = '#d1fae5';
                    statusEl.style.color = '#065f46';
                    statusEl.style.display = 'block';
                    
                    showAlert('success', 'Employee salary resumed successfully!');
                    
                    // Clear form
                    document.getElementById('manageEmpAddress').value = '';
                    
                } else {
                    statusEl.textContent = `‚ùå Error: ${result.message || result.error}`;
                    statusEl.style.background = '#fee2e2';
                    statusEl.style.color = '#991b1b';
                    statusEl.style.display = 'block';
                    
                    showAlert('error', result.message || 'Failed to resume salary');
                }
                
            } catch (error) {
                console.error('Error:', error);
                statusEl.textContent = `‚ùå Connection Error: ${error.message}. Make sure the backend server is running!`;
                statusEl.style.background = '#fee2e2';
                statusEl.style.color = '#991b1b';
                statusEl.style.display = 'block';
                
                showAlert('error', 'Backend server not running!');
            } finally {
                btn.disabled = false;
                btn.innerHTML = '‚ñ∂Ô∏è Resume Salary';
            }
        }

        // Claim My Salary (Employee Self-Service)
        async function claimMySalary() {
            const btn = document.getElementById('claimSalaryBtn');
            const statusEl = document.getElementById('claimSalaryStatus');
            const alertEl = document.getElementById('claimSalaryAlert');
            
            // Get form values
            const name = document.getElementById('claimEmpName').value.trim();
            const address = document.getElementById('claimEmpAddress').value.trim();
            
            // Hide previous alerts
            alertEl.style.display = 'none';
            statusEl.style.display = 'none';
            
            // Validation
            if (!address) {
                alertEl.textContent = '‚ùå Please enter your Stellar address!';
                alertEl.style.background = '#fee2e2';
                alertEl.style.color = '#991b1b';
                alertEl.style.display = 'block';
                return;
            }
            
            if (!address.startsWith('G') || address.length !== 56) {
                alertEl.textContent = '‚ùå Invalid Stellar address! Must start with G and be 56 characters.';
                alertEl.style.background = '#fee2e2';
                alertEl.style.color = '#991b1b';
                alertEl.style.display = 'block';
                return;
            }
            
            // Confirm action
            const confirmed = confirm(
                `üí∞ Claim Your Salary\n\n` +
                `You are about to claim your monthly salary.\n\n` +
                `Employee: ${name || 'Unknown'}\n` +
                `Address: ${address.substring(0, 15)}...${address.substring(50)}\n\n` +
                `‚ö†Ô∏è Note: You can only claim once per month!\n\n` +
                `Proceed with claiming?`
            );
            
            if (!confirmed) {
                return;
            }
            
            // Disable button and show loading
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Claiming salary...';
            
            statusEl.innerHTML = '<p style="text-align: center; color: #047857; padding: 10px;">‚è≥ Processing your claim...<br><small>Checking eligibility and transferring funds...</small></p>';
            statusEl.style.background = '#ecfdf5';
            statusEl.style.display = 'block';
            
            try {
                // Call backend API
                const response = await fetch('http://localhost:3000/api/claim-salary', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        employeeAddress: address,
                        employeeName: name || 'Anonymous'
                    })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    // Success!
                    let html = '<div style="background: #d1fae5; padding: 15px; border-radius: 8px;">';
                    html += `<h4 style="color: #065f46; margin: 0 0 10px 0;">‚úÖ ${result.message}</h4>`;
                    html += `<p style="color: #047857; margin: 0;"><strong>Employee:</strong> ${result.data.employeeName}</p>`;
                    html += `<p style="color: #047857; margin: 5px 0 0 0;"><strong>Address:</strong> ${result.data.employeeAddress.substring(0, 20)}...</p>`;
                    if (result.note) {
                        html += `<p style="color: #047857; margin: 10px 0 0 0; font-weight: 600;">üí∞ ${result.note}</p>`;
                    }
                    html += '</div>';
                    
                    statusEl.innerHTML = html;
                    statusEl.style.background = 'white';
                    statusEl.style.border = '2px solid #10b981';
                    statusEl.style.display = 'block';
                    
                    showAlert('success', `Salary claimed successfully! Check your account.`);
                    
                    // Clear form
                    document.getElementById('claimEmpName').value = '';
                    document.getElementById('claimEmpAddress').value = '';
                    
                    // Refresh treasury info after 3 seconds
                    setTimeout(() => {
                        loadTreasuryInfo();
                    }, 3000);
                    
                } else {
                    // Error from backend
                    let html = '<div style="background: #fee2e2; padding: 15px; border-radius: 8px;">';
                    html += `<p style="color: #991b1b; margin: 0;"><strong>‚ùå ${result.error}</strong></p>`;
                    html += `<p style="color: #991b1b; margin: 10px 0 0 0;">${result.message}</p>`;
                    if (result.note) {
                        html += `<p style="color: #991b1b; margin: 10px 0 0 0; font-size: 0.9em;">${result.note}</p>`;
                    }
                    html += '</div>';
                    
                    statusEl.innerHTML = html;
                    statusEl.style.background = 'white';
                    statusEl.style.display = 'block';
                    
                    showAlert('error', result.message || 'Failed to claim salary');
                }
                
            } catch (error) {
                console.error('Error:', error);
                
                let html = '<div style="background: #fee2e2; padding: 15px; border-radius: 8px;">';
                html += `<p style="color: #991b1b; margin: 0;"><strong>‚ùå Connection Error</strong></p>`;
                html += `<p style="color: #991b1b; margin: 10px 0 0 0;">${error.message}</p>`;
                html += `<p style="color: #991b1b; margin: 10px 0 0 0; font-size: 0.9em;">Make sure the backend server is running!</p>`;
                html += '</div>';
                
                statusEl.innerHTML = html;
                statusEl.style.background = 'white';
                statusEl.style.display = 'block';
                
                showAlert('error', 'Backend server not running! Start it with: node backend_server.js');
            } finally {
                // Re-enable button
                btn.disabled = false;
                btn.innerHTML = 'üí∞ Claim My Salary Now';
            }
        }

        // Check for Freighter on load
        window.onload = function() {
            // Load employees and treasury automatically on page load
            loadEmployees();
            loadTreasuryInfo();
            
            if (window.freighterApi) {
                showAlert('info', 'Freighter detected! Click "Connect Freighter" to get started.');
            } else {
                showAlert('info', 'Install Freighter wallet to interact with the contract.');
            }
        };
    </script>
</body>
</html>
