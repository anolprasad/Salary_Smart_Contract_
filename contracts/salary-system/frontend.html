<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Decentralized Salary System - Real Testnet</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.2);
        }

        .badge {
            display: inline-block;
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: bold;
            background: #10b981;
            color: white;
            margin-left: 10px;
        }

        .badge-testnet {
            background: #f59e0b;
        }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .card h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
            border-bottom: 3px solid #667eea;
            padding-bottom: 10px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f0f4ff;
            border-radius: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #ef4444;
        }

        .status-dot.connected {
            background: #10b981;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }

        input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        input:focus {
            outline: none;
            border-color: #667eea;
        }

        button[onclick*="copy"],
        button[onclick*="window.open"] {
            transition: all 0.3s ease;
        }

        button[onclick*="copy"]:hover {
            background: #5a67d8 !important;
            transform: translateY(-1px);
        }

        button[onclick*="window.open"]:hover {
            background: #059669 !important;
            transform: translateY(-1px);
        }

        input:disabled {
            background: #f3f4f6;
            cursor: not-allowed;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1em;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        button:active:not(:disabled) {
            transform: translateY(0);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-secondary {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .alert.show {
            display: block;
            animation: slideIn 0.3s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-20px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .alert-success {
            background: #d1fae5;
            color: #065f46;
            border-left: 4px solid #10b981;
        }

        .alert-error {
            background: #fee2e2;
            color: #991b1b;
            border-left: 4px solid #ef4444;
        }

        .alert-info {
            background: #dbeafe;
            color: #1e40af;
            border-left: 4px solid #3b82f6;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .info-box {
            background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%);
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
        }

        .info-box h3 {
            color: #667eea;
            font-size: 0.9em;
            text-transform: uppercase;
            margin-bottom: 10px;
        }

        .info-box p {
            font-size: 1.8em;
            font-weight: bold;
            color: #333;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .code-box {
            background: #f3f4f6;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            font-size: 0.9em;
            word-break: break-all;
            margin: 10px 0;
        }

        .two-column {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
        }

        .transaction-card {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }

        .transaction-card:hover {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transform: translateY(-2px);
        }

        .tx-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e5e7eb;
        }

        .tx-type {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8em;
            font-weight: bold;
            background: #667eea;
            color: white;
        }

        .tx-time {
            color: #888;
            font-size: 0.85em;
        }

        .tx-hash {
            font-family: monospace;
            font-size: 0.85em;
            color: #667eea;
            word-break: break-all;
            margin: 5px 0;
        }

        .tx-details {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid #f3f4f6;
            font-size: 0.9em;
            color: #666;
        }

        @media (max-width: 768px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíº Decentralized Salary System</h1>
            <span class="badge">Monthly Payments</span>
            <span class="badge badge-testnet">üåê Testnet</span>
            <p style="margin-top: 10px;">Real Blockchain Transactions via Freighter</p>
        </div>

        <!-- Alert Messages -->
        <div id="alertSuccess" class="alert alert-success"></div>
        <div id="alertError" class="alert alert-error"></div>
        <div id="alertInfo" class="alert alert-info"></div>

        <!-- Freighter Connection -->
        <div class="card">
            <h2>üîê Wallet Connection</h2>
            
            <!-- Connection Status -->
            <div class="connection-status">
                <div class="status-dot" id="statusDot"></div>
                <div>
                    <strong>Status:</strong> <span id="connectionStatus">Not Connected</span>
                </div>
            </div>
            
            <div id="connectedInfo" style="display: none; margin-bottom: 15px;">
                <div class="code-box">
                    <strong>Your Address:</strong><br>
                    <span id="walletAddress"></span>
                </div>
                <button onclick="disconnectWallet()" style="margin-top: 10px; background: #ef4444; padding: 10px 20px; font-size: 0.9em;">
                    üîå Disconnect Wallet
                </button>
            </div>

            <!-- Option 1: Freighter Wallet -->
            <div style="margin-bottom: 20px;">
                <h3 style="color: #667eea; font-size: 1.1em; margin-bottom: 10px;">Option 1: Connect via Freighter ü¶ä</h3>
                <button onclick="connectFreighter()" id="connectBtn">Connect Freighter Wallet</button>
                <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                    Automatically connects to your Freighter browser extension
                </p>
            </div>

            <!-- OR Divider -->
            <div style="text-align: center; margin: 30px 0; position: relative;">
                <div style="height: 1px; background: #e5e7eb;"></div>
                <span style="position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: white; padding: 0 15px; color: #888; font-weight: 600;">OR</span>
            </div>

            <!-- Option 2: Manual Address Input -->
            <div>
                <h3 style="color: #667eea; font-size: 1.1em; margin-bottom: 10px;">Option 2: Enter Address Manually ‚úçÔ∏è</h3>
                <div class="form-group">
                    <label for="manualAddress">Stellar Address (starts with G...):</label>
                    <input 
                        type="text" 
                        id="manualAddress" 
                        placeholder="GXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
                        style="font-family: monospace; font-size: 0.9em;"
                    >
                </div>
                <button onclick="connectManually()">Connect with This Address</button>
                <p style="color: #666; font-size: 0.9em; margin-top: 10px;">
                    Use this if you don't have Freighter installed or prefer manual entry
                </p>
            </div>

            <!-- Quick Address Buttons -->
            <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                <h4 style="color: #0369a1; margin-bottom: 10px;">üîë Quick Connect (Known Accounts):</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 10px;">
                    <button onclick="quickConnect('GBPAKDYZKKXENIPOXGYCB2ZEVRQKK2JEBLPJ3CHK7MRMBZLHNPTGJAZE')" style="padding: 8px 12px; font-size: 0.85em; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üë§ Alice (Admin)
                    </button>
                    <button onclick="quickConnect('GCBGNIA2KZ5C5Q3X737DEPBOUB56F5VRVSRBW5YX6CR6UH5KTYIYOYVA')" style="padding: 8px 12px; font-size: 0.85em; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üë§ Employee 1
                    </button>
                    <button onclick="quickConnect('GCBDACPLLDVEC67IO6V7DCOVZFUH4DP5UTSO5CPHIB46F4VRN7PWGAT3')" style="padding: 8px 12px; font-size: 0.85em; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üë§ Employee 2
                    </button>
                    <button onclick="quickConnect('GBXCEWXR6J4DRLYCWCUBHBSKBFOQ3T4AJM5MXKCE6V3TAUJNBG6LDTNP')" style="padding: 8px 12px; font-size: 0.85em; background: #10b981; color: white; border: none; border-radius: 6px; cursor: pointer;">
                        üë§ Employee 3
                    </button>
                </div>
                <p style="color: #666; font-size: 0.85em; margin-top: 10px;">
                    Click to quickly connect as a known account from this system
                </p>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <strong>‚ö†Ô∏è Freighter Setup:</strong>
                <ul style="margin-left: 20px; margin-top: 10px;">
                    <li>Install Freighter: <a href="https://www.freighter.app/" target="_blank" style="color: #d97706;">freighter.app</a></li>
                    <li>Switch to <strong>TESTNET</strong> in Freighter settings</li>
                    <li>Get testnet XLM from <a href="https://laboratory.stellar.org/#account-creator?network=test" target="_blank" style="color: #d97706;">Friendbot</a></li>
                </ul>
            </div>
        </div>

        <!-- Contract Info -->
        <div class="card">
            <h2>üìã Contract Information</h2>
            <div class="info-grid">
                <div class="info-box">
                    <h3>Contract Status</h3>
                    <p style="font-size: 1.2em;">‚úÖ Live on Testnet</p>
                </div>
                <div class="info-box">
                    <h3>Network</h3>
                    <p style="font-size: 1.2em;">Stellar Testnet</p>
                </div>
            </div>
            <div class="code-box">
                <strong>Contract ID:</strong><br>
                CDXYPMRADZYRBUI2GNYICZBS7H6GJLX7BI3DI4HCUG2YISRR3NTLL4R4
            </div>
            <div class="code-box">
                <strong>Token Address (Native XLM):</strong><br>
                CDLZFC3SYJYDZT7K67VZ75HPJVIEUVNIXF47ZG2FB2RMQQVU2HHGCYSC
            </div>
            <a href="https://stellar.expert/explorer/testnet/contract/CDXYPMRADZYRBUI2GNYICZBS7H6GJLX7BI3DI4HCUG2YISRR3NTLL4R4" target="_blank" style="display: inline-block; margin-top: 15px; color: #667eea; font-weight: 600;">
                View on Stellar Expert ‚Üí
            </a>
        </div>

        <!-- Treasury & Sustainability -->
        <div class="card">
            <h2>üí∞ Treasury & Sustainability Analysis</h2>
            <p style="color: #666; margin-bottom: 15px;">
                Check treasury balance and calculate how many years the funds will last
            </p>
            
            <div style="margin-bottom: 20px;">
                <button onclick="loadTreasuryInfo()" id="loadTreasuryBtn">
                    üìä Load Treasury Information
                </button>
            </div>

            <div id="treasuryInfo" style="margin-top: 20px;">
                <p style="color: #888; text-align: center; padding: 20px;">
                    Click "Load Treasury Information" to fetch balance and sustainability data
                </p>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                <h3 style="color: #0369a1; margin-bottom: 15px;">üí° Understanding Sustainability</h3>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 10px;">
                    The sustainability calculation considers:
                </p>
                <ul style="margin-left: 20px; color: #666; font-size: 0.9em;">
                    <li>Current treasury balance</li>
                    <li>All active employees' salaries</li>
                    <li>5% annual salary increments (compound)</li>
                    <li>12 monthly payments per year</li>
                </ul>
                <p style="color: #666; font-size: 0.9em; margin-top: 15px;">
                    <strong>Example:</strong> If you have 3 employees (6 XLM/month) and 300 XLM in treasury, 
                    it will calculate year-by-year with increments until funds run out.
                </p>
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                <strong>üìñ CLI Commands:</strong>
                <div class="code-box" style="background: #1f2937; color: #10b981; margin-top: 10px;">
# Check treasury balance
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- get_treasury_balance

# Calculate sustainability years
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- calculate_sustainability_years
                </div>
            </div>
        </div>

        <!-- Employee Management -->
        <div class="card">
            <h2>üë• Employee Management</h2>
            <p style="color: #666; margin-bottom: 15px;">
                Current employees in the salary system
            </p>
            
            <div style="margin-bottom: 20px;">
                <button onclick="loadEmployees()" id="loadEmpBtn">
                    üë§ Load All Employees
                </button>
            </div>

            <div id="employeesList" style="margin-top: 20px;">
                <p style="color: #888; text-align: center; padding: 20px;">
                    Click "Load All Employees" to fetch employee list from the blockchain
                </p>
            </div>

            <div style="margin-top: 30px; padding: 20px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">
                <h3 style="color: #0369a1; margin-bottom: 15px;">‚ûï Add New Employee</h3>
                <p style="color: #666; font-size: 0.9em; margin-bottom: 15px;">
                    Use the CLI command below or the script to add employees:
                </p>
                <div class="code-box" style="background: #1f2937; color: #10b981; margin-bottom: 10px;">
# Easy way - Use the script:
./add_employee.sh employee_name annual_salary_xlm

# Example: Add employee with 120 XLM/year (10 XLM/month)
./add_employee.sh john 120
                </div>
                <div class="code-box" style="background: #1f2937; color: #10b981;">
# Manual way - Using CLI:
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- add_employee \
  --employee_address EMPLOYEE_ADDRESS \
  --name "Employee Name" \
  --base_salary 120000000
                </div>
            </div>
        </div>

        <!-- Salary Operations -->
        <div class="card">
            <h2>üí∞ Salary Operations</h2>
            
            <div style="margin-bottom: 30px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">Pay All Employees</h3>
                <p style="color: #666; margin-bottom: 10px;">
                    Pay monthly salaries to all active employees at once:
                </p>
                <div class="code-box" style="background: #1f2937; color: #10b981;">
./pay_all_salaries.sh
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #667eea; margin-bottom: 15px;">Pay Single Employee</h3>
                <p style="color: #666; margin-bottom: 10px;">
                    Pay a specific employee's monthly salary:
                </p>
                <div class="code-box" style="background: #1f2937; color: #10b981;">
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- pay_salary \
  --employee_address EMPLOYEE_ADDRESS
                </div>
            </div>

            <div>
                <h3 style="color: #667eea; margin-bottom: 15px;">Fund Treasury</h3>
                <p style="color: #666; margin-bottom: 10px;">
                    Add XLM to the contract treasury for payroll:
                </p>
                <div class="code-box" style="background: #1f2937; color: #10b981;">
# Fund with 500 XLM
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- fund_treasury \
  --from $(stellar keys address alice) \
  --amount 50000000000
                </div>
            </div>
        </div>

        <!-- Employee Self-Service -->
        <div class="card" style="border-left: 4px solid #10b981;">
            <h2>üéâ Employee Self-Service (NEW!)</h2>
            <p style="color: #666; margin-bottom: 20px;">
                <strong>Employees can now claim their own salaries!</strong> No need to wait for admin - withdraw your monthly payment anytime.
            </p>

            <div style="padding: 20px; background: #f0fdf4; border-radius: 8px; border-left: 4px solid #10b981; margin-bottom: 25px;">
                <h3 style="color: #059669; margin-bottom: 15px;">‚ú® How It Works</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 15px;">
                    <div>
                        <div style="font-size: 2em; margin-bottom: 5px;">üîê</div>
                        <strong style="color: #047857;">Secure</strong>
                        <p style="color: #666; font-size: 0.9em; margin-top: 5px;">Only you can claim your salary</p>
                    </div>
                    <div>
                        <div style="font-size: 2em; margin-bottom: 5px;">‚è±Ô∏è</div>
                        <strong style="color: #047857;">Flexible</strong>
                        <p style="color: #666; font-size: 0.9em; margin-top: 5px;">Claim anytime during the month</p>
                    </div>
                    <div>
                        <div style="font-size: 2em; margin-bottom: 5px;">‚úÖ</div>
                        <strong style="color: #047857;">Protected</strong>
                        <p style="color: #666; font-size: 0.9em; margin-top: 5px;">One claim per month limit</p>
                    </div>
                </div>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #059669; margin-bottom: 15px;">üí∞ Claim Your Salary</h3>
                <p style="color: #666; margin-bottom: 15px;">
                    Use the script to easily claim your monthly salary:
                </p>
                <div class="code-box" style="background: #1f2937; color: #10b981; margin-bottom: 10px;">
# Claim your salary (replace with your employee name)
./claim_my_salary.sh employee1
./claim_my_salary.sh employee2
./claim_my_salary.sh employee3
                </div>
                
                <p style="color: #666; margin-top: 15px; margin-bottom: 10px;">
                    Or use the CLI command directly:
                </p>
                <div class="code-box" style="background: #1f2937; color: #10b981;">
stellar contract invoke \
  --id salary_system \
  --source-account employee1 \
  --network testnet \
  -- claim_salary \
  --employee_address $(stellar keys address employee1)
                </div>
            </div>

            <div style="padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b; margin-bottom: 25px;">
                <strong style="color: #92400e;">‚ö†Ô∏è Important Rules:</strong>
                <ul style="margin-left: 20px; margin-top: 10px; color: #78350f;">
                    <li>You can only claim <strong>once per month</strong></li>
                    <li>Must be an <strong>active employee</strong></li>
                    <li>Treasury must have <strong>sufficient balance</strong></li>
                    <li>Your salary includes <strong>5% annual increment</strong></li>
                </ul>
            </div>

            <div style="margin-bottom: 30px;">
                <h3 style="color: #059669; margin-bottom: 15px;">üÜö Admin Payment vs Self-Service</h3>
                <div style="overflow-x: auto;">
                    <table style="width: 100%; border-collapse: collapse; font-size: 0.9em;">
                        <thead>
                            <tr style="background: #f3f4f6;">
                                <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb;">Feature</th>
                                <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb;">Admin Payment</th>
                                <th style="padding: 12px; text-align: left; border: 1px solid #e5e7eb;">Self-Service ‚ú®</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Who initiates</strong></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Admin (alice)</td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Employee themselves</td>
                            </tr>
                            <tr style="background: #f9fafb;">
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Authentication</strong></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Admin account</td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Employee account</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Function</strong></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><code>pay_salary</code></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><code>claim_salary</code></td>
                            </tr>
                            <tr style="background: #f9fafb;">
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Use case</strong></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Bulk payments</td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Individual withdrawal</td>
                            </tr>
                            <tr>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong>Control</strong></td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;">Centralized</td>
                                <td style="padding: 10px; border: 1px solid #e5e7eb;"><strong style="color: #059669;">Decentralized üéâ</strong></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div style="padding: 20px; background: #eff6ff; border-radius: 8px; border-left: 4px solid #3b82f6;">
                <h3 style="color: #1e40af; margin-bottom: 15px;">üìö Learn More</h3>
                <p style="color: #666; margin-bottom: 10px;">
                    For detailed documentation, see:
                </p>
                <ul style="margin-left: 20px; color: #1e40af;">
                    <li><code>EMPLOYEE_SELF_SERVICE.md</code> - Complete guide</li>
                    <li><code>claim_my_salary.sh</code> - Ready-to-use script</li>
                </ul>
            </div>
        </div>

        <!-- Instructions -->
        <div class="card">
            <h2>üìñ How to Use (CLI Required)</h2>
            <p style="color: #666; margin-bottom: 15px;">
                This contract requires the <strong>Stellar CLI</strong> to interact with. The frontend shows information but cannot sign transactions directly.
            </p>
            
            <h3 style="color: #667eea; margin-top: 20px; margin-bottom: 10px;">1Ô∏è‚É£ Fund the Treasury</h3>
            <div class="code-box" style="background: #1f2937; color: #10b981;">
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- fund_treasury \
  --from $(stellar keys address alice) \
  --amount 1000000000
            </div>

            <h3 style="color: #667eea; margin-top: 20px; margin-bottom: 10px;">2Ô∏è‚É£ Add an Employee</h3>
            <div class="code-box" style="background: #1f2937; color: #10b981;">
# Create employee account
stellar keys generate employee1 --network testnet --fund

# Add to contract
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- add_employee \
  --employee_address $(stellar keys address employee1) \
  --name "John Doe" \
  --base_salary 120000000
            </div>

            <h3 style="color: #667eea; margin-top: 20px; margin-bottom: 10px;">3Ô∏è‚É£ Pay Monthly Salary</h3>
            <div class="code-box" style="background: #1f2937; color: #10b981;">
stellar contract invoke \
  --id salary_system \
  --source-account alice \
  --network testnet \
  -- pay_salary \
  --employee_address $(stellar keys address employee1)
            </div>

            <div style="margin-top: 20px; padding: 15px; background: #dbeafe; border-radius: 8px;">
                <strong>üí° Tip:</strong> Run <code style="background: white; padding: 2px 6px; border-radius: 4px;">./test_real_transfer.sh</code> in your project folder to test everything automatically!
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card">
            <h2>‚ö° Quick Links</h2>
            <div style="display: grid; gap: 10px;">
                <a href="https://laboratory.stellar.org/#account-creator?network=test" target="_blank" style="display: block; padding: 15px; background: #f0f4ff; border-radius: 8px; color: #667eea; text-decoration: none; font-weight: 600;">
                    ü™ô Get Testnet XLM (Friendbot)
                </a>
                <a href="https://stellar.expert/explorer/testnet/contract/CDXYPMRADZYRBUI2GNYICZBS7H6GJLX7BI3DI4HCUG2YISRR3NTLL4R4" target="_blank" style="display: block; padding: 15px; background: #f0f4ff; border-radius: 8px; color: #667eea; text-decoration: none; font-weight: 600;">
                    üîç View Contract on Stellar Expert
                </a>
                <a href="https://www.freighter.app/" target="_blank" style="display: block; padding: 15px; background: #f0f4ff; border-radius: 8px; color: #667eea; text-decoration: none; font-weight: 600;">
                    ü¶ä Install Freighter Wallet
                </a>
            </div>
        </div>
    </div>

    <script>
        // Contract Configuration
        const CONTRACT_ID = 'CDXYPMRADZYRBUI2GNYICZBS7H6GJLX7BI3DI4HCUG2YISRR3NTLL4R4';
        const TOKEN_ADDRESS = 'CDLZFC3SYJYDZT7K67VZ75HPJVIEUVNIXF47ZG2FB2RMQQVU2HHGCYSC';
        const NETWORK_PASSPHRASE = 'Test SDF Network ; September 2015';
        
        let walletAddress = null;
        let freighter = null;

        // Connect to Freighter
        async function connectFreighter() {
            try {
                // Check if Freighter is installed
                if (!window.freighterApi) {
                    showAlert('error', 'Freighter wallet not found! Please install it from freighter.app or use manual address entry below.');
                    return;
                }

                freighter = window.freighterApi;

                // Request access
                const isAllowed = await freighter.isAllowed();
                if (!isAllowed) {
                    await freighter.setAllowed();
                }

                // Get public key
                walletAddress = await freighter.getPublicKey();
                
                // Check network
                const network = await freighter.getNetwork();
                if (network !== 'TESTNET') {
                    showAlert('error', 'Please switch Freighter to TESTNET in settings!');
                    return;
                }

                // Update UI
                updateConnectionUI(walletAddress, 'Freighter');

            } catch (error) {
                console.error('Freighter connection error:', error);
                showAlert('error', 'Failed to connect: ' + error.message);
            }
        }

        // Connect manually with address
        function connectManually() {
            const address = document.getElementById('manualAddress').value.trim();
            
            // Validate address format
            if (!address) {
                showAlert('error', 'Please enter a Stellar address');
                return;
            }
            
            if (!address.startsWith('G') || address.length !== 56) {
                showAlert('error', 'Invalid Stellar address. Must start with G and be 56 characters long.');
                return;
            }

            walletAddress = address;
            updateConnectionUI(address, 'Manual');
        }

        // Quick connect with predefined address
        function quickConnect(address) {
            walletAddress = address;
            document.getElementById('manualAddress').value = address;
            updateConnectionUI(address, 'Quick Connect');
        }

        // Update connection UI
        function updateConnectionUI(address, method) {
            document.getElementById('connectionStatus').textContent = `Connected via ${method}`;
            document.getElementById('statusDot').classList.add('connected');
            document.getElementById('walletAddress').textContent = address;
            document.getElementById('connectedInfo').style.display = 'block';
            
            // Disable connect buttons
            document.getElementById('connectBtn').textContent = 'Connected ‚úì';
            document.getElementById('connectBtn').disabled = true;

            showAlert('success', `Connected! Address: ${address.substring(0, 10)}...${address.substring(50)}`);
        }

        // Disconnect wallet
        function disconnectWallet() {
            walletAddress = null;
            document.getElementById('connectionStatus').textContent = 'Not Connected';
            document.getElementById('statusDot').classList.remove('connected');
            document.getElementById('connectedInfo').style.display = 'none';
            document.getElementById('connectBtn').textContent = 'Connect Freighter Wallet';
            document.getElementById('connectBtn').disabled = false;
            document.getElementById('manualAddress').value = '';
            showAlert('info', 'Wallet disconnected');
        }

        // Helper Functions
        function showAlert(type, message) {
            const alertMap = {
                'success': 'alertSuccess',
                'error': 'alertError',
                'info': 'alertInfo'
            };

            const alertId = alertMap[type];
            const alertEl = document.getElementById(alertId);
            alertEl.textContent = message;
            alertEl.classList.add('show');

            setTimeout(() => {
                alertEl.classList.remove('show');
            }, 5000);
        }

        // Load Employees List
        async function loadEmployees() {
            const btn = document.getElementById('loadEmpBtn');
            const listEl = document.getElementById('employeesList');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Loading...';
            listEl.innerHTML = '<p style="text-align: center; color: #888;">Fetching employees from contract...</p>';

            try {
                showAlert('info', 'Use CLI to get employee list: stellar contract invoke --id salary_system --source-account alice --network testnet -- get_all_employees');
                
                // Hardcoded current employees for demonstration
                const employees = [
                    {
                        name: 'employee1',
                        address: 'GCBGNIA2KZ5C5Q3X737DEPBOUB56F5VRVSRBW5YX6CR6UH5KTYIYOYVA',
                        annualSalary: 12,
                        monthlySalary: 1
                    },
                    {
                        name: 'employee2',
                        address: 'GCBDACPLLDVEC67IO6V7DCOVZFUH4DP5UTSO5CPHIB46F4VRN7PWGAT3',
                        annualSalary: 24,
                        monthlySalary: 2
                    },
                    {
                        name: 'employee3',
                        address: 'GBXCEWXR6J4DRLYCWCUBHBSKBFOQ3T4AJM5MXKCE6V3TAUJNBG6LDTNP',
                        annualSalary: 36,
                        monthlySalary: 3
                    }
                ];

                if (employees.length === 0) {
                    listEl.innerHTML = '<p style="text-align: center; color: #888;">No employees found. Add some using the CLI commands below!</p>';
                    return;
                }

                // Display employees
                let html = '<div style="margin-bottom: 15px; padding: 10px; background: #f0f9ff; border-radius: 8px;"><strong>Total Employees:</strong> ' + employees.length + ' | <strong>Monthly Payroll:</strong> ' + employees.reduce((sum, e) => sum + e.monthlySalary, 0) + ' XLM</div>';
                
                for (const emp of employees) {
                    html += `
                        <div class="transaction-card">
                            <div class="tx-header">
                                <span class="tx-type">üë§ ${emp.name.toUpperCase()}</span>
                                <span class="tx-time">${emp.monthlySalary} XLM/month</span>
                            </div>
                            <div>
                                <strong>Address:</strong><br>
                                <a href="https://stellar.expert/explorer/testnet/account/${emp.address}" 
                                   target="_blank" 
                                   class="tx-hash">${emp.address}</a>
                            </div>
                            <div class="tx-details">
                                <div><strong>Annual Salary:</strong> ${emp.annualSalary} XLM</div>
                                <div><strong>Monthly Salary:</strong> ${emp.monthlySalary} XLM</div>
                                <div><strong>Status:</strong> ‚úÖ Active</div>
                            </div>
                            <div style="margin-top: 10px; padding-top: 10px; border-top: 1px solid #e5e7eb;">
                                <button onclick="copyToClipboard('${emp.address}')" style="padding: 5px 10px; font-size: 0.85em; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                                    üìã Copy Address
                                </button>
                                <button onclick="window.open('https://stellar.expert/explorer/testnet/account/${emp.address}', '_blank')" style="padding: 5px 10px; font-size: 0.85em; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; margin-left: 5px;">
                                    üîç View Details
                                </button>
                            </div>
                        </div>
                    `;
                }

                listEl.innerHTML = html;
                showAlert('success', `Loaded ${employees.length} employees`);

            } catch (error) {
                console.error('Error loading employees:', error);
                listEl.innerHTML = `
                    <div style="padding: 20px; background: #fee; border-radius: 8px; color: #c00;">
                        <strong>Note:</strong> Employee list is shown from the last known state.<br>
                        To get real-time data, use the CLI command:<br><br>
                        <code style="background: white; padding: 5px; border-radius: 4px; display: block; margin-top: 10px;">
                        stellar contract invoke --id salary_system --source-account alice --network testnet -- get_all_employees
                        </code>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üîÑ Reload Employees';
            }
        }

        // Copy to clipboard helper
        function copyToClipboard(text) {
            navigator.clipboard.writeText(text).then(() => {
                showAlert('success', 'Address copied to clipboard!');
            }).catch(err => {
                showAlert('error', 'Failed to copy: ' + err.message);
            });
        }

        // Load Treasury Information
        async function loadTreasuryInfo() {
            const btn = document.getElementById('loadTreasuryBtn');
            const infoEl = document.getElementById('treasuryInfo');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Loading...';
            infoEl.innerHTML = '<p style="text-align: center; color: #888;">Calculating treasury information...</p>';

            try {
                showAlert('info', 'Use CLI to get real-time data: stellar contract invoke --id salary_system --source-account alice --network testnet -- get_treasury_balance');
                
                // Simulated data - In production, this would call the contract via CLI or SDK
                const treasuryBalance = 296; // XLM (from our last test)
                const monthlyPayroll = 6; // XLM (1 + 2 + 3)
                const annualPayroll = monthlyPayroll * 12; // 72 XLM
                
                // Calculate actual sustainability with 5% compound increments
                let balance = treasuryBalance;
                let years = 0;
                let currentAnnualCost = annualPayroll;
                
                while (balance >= currentAnnualCost) {
                    balance -= currentAnnualCost;
                    years++;
                    currentAnnualCost = currentAnnualCost * 1.05; // 5% increment
                    if (years > 100) break; // Safety limit
                }
                
                const sustainabilityYears = years;
                
                // Calculate additional metrics
                const simpleYears = Math.floor(treasuryBalance / annualPayroll);
                const currentMonth = new Date().toLocaleDateString('en-US', { month: 'long', year: 'numeric' });
                
                // Determine status based on sustainability
                let statusEmoji = '‚úÖ';
                let statusText = 'Healthy';
                let statusColor = '#8b5cf6';
                
                if (sustainabilityYears >= 5) {
                    statusEmoji = '‚úÖ';
                    statusText = 'Excellent';
                    statusColor = '#10b981';
                } else if (sustainabilityYears >= 2) {
                    statusEmoji = '‚úÖ';
                    statusText = 'Good';
                    statusColor = '#3b82f6';
                } else if (sustainabilityYears >= 1) {
                    statusEmoji = '‚ö†Ô∏è';
                    statusText = 'Fair';
                    statusColor = '#f59e0b';
                } else {
                    statusEmoji = '‚ùå';
                    statusText = 'Critical';
                    statusColor = '#ef4444';
                }

                let html = `
                    <div class="info-grid" style="margin-bottom: 20px;">
                        <div class="info-box" style="background: linear-gradient(135deg, #10b98115 0%, #059f6915 100%); border-left: 4px solid #10b981;">
                            <h3 style="color: #10b981;">Treasury Balance</h3>
                            <p style="color: #059669;">${treasuryBalance} XLM</p>
                            <small style="color: #666; font-size: 0.8em;">‚âà ${(treasuryBalance * 10000000).toLocaleString()} stroops</small>
                        </div>
                        <div class="info-box" style="background: linear-gradient(135deg, #3b82f615 0%, #2563eb15 100%); border-left: 4px solid #3b82f6;">
                            <h3 style="color: #3b82f6;">Monthly Payroll</h3>
                            <p style="color: #2563eb;">${monthlyPayroll} XLM</p>
                            <small style="color: #666; font-size: 0.8em;">Annual: ${annualPayroll} XLM</small>
                        </div>
                        <div class="info-box" style="background: linear-gradient(135deg, #f59e0b15 0%, #d9770615 100%); border-left: 4px solid #f59e0b;">
                            <h3 style="color: #f59e0b;">Sustainability</h3>
                            <p style="color: #d97706;">${sustainabilityYears} Years</p>
                            <small style="color: #666; font-size: 0.8em;">With 5% annual increments</small>
                        </div>
                        <div class="info-box" style="background: linear-gradient(135deg, #8b5cf615 0%, #7c3aed15 100%); border-left: 4px solid ${statusColor};">
                            <h3 style="color: ${statusColor};">Status</h3>
                            <p style="color: ${statusColor}; font-size: 1.5em;">${statusEmoji} ${statusText}</p>
                            <small style="color: #666; font-size: 0.8em;">As of ${currentMonth}</small>
                        </div>
                    </div>

                    <div style="padding: 20px; background: linear-gradient(135deg, #667eea15 0%, #764ba215 100%); border-radius: 10px; border-left: 4px solid #667eea; margin-bottom: 20px;">
                        <h3 style="color: #667eea; margin-bottom: 15px;">üìà Detailed Analysis</h3>
                        <div style="display: grid; gap: 10px; color: #333;">
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                <span><strong>Current Balance:</strong></span>
                                <span>${treasuryBalance} XLM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                <span><strong>Monthly Expenses:</strong></span>
                                <span>${monthlyPayroll} XLM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                <span><strong>Annual Expenses (Year 1):</strong></span>
                                <span>${annualPayroll} XLM</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                <span><strong>Annual Increment Rate:</strong></span>
                                <span>5% (compound)</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: white; border-radius: 6px;">
                                <span><strong>Simple Calculation:</strong></span>
                                <span>${simpleYears} years (without increments)</span>
                            </div>
                            <div style="display: flex; justify-content: space-between; padding: 8px; background: #10b981; color: white; border-radius: 6px; font-weight: bold;">
                                <span><strong>With 5% Increments:</strong></span>
                                <span>${sustainabilityYears} YEARS üéØ</span>
                            </div>
                        </div>
                    </div>

                    <div style="padding: 15px; background: #dbeafe; border-radius: 8px; border-left: 4px solid #3b82f6; margin-bottom: 20px;">
                        <h4 style="color: #1e40af; margin-bottom: 10px;">üí° What This Means:</h4>
                        <ul style="margin-left: 20px; color: #1e3a8a; line-height: 1.8;">
                            <li>With <strong>5% annual salary increments</strong>, your treasury can sustain all employees for <strong>${sustainabilityYears} years</strong></li>
                            <li>Year 1 expenses: ${annualPayroll} XLM ‚Üí Year 2 expenses: ${(annualPayroll * 1.05).toFixed(2)} XLM ‚Üí And so on...</li>
                            <li>The smart contract calculates year-by-year until treasury is depleted</li>
                            <li>To extend sustainability: Fund more XLM or reduce payroll</li>
                        </ul>
                    </div>

                    <div style="padding: 15px; background: #fef3c7; border-radius: 8px; border-left: 4px solid #f59e0b;">
                        <h4 style="color: #92400e; margin-bottom: 10px;">‚ö†Ô∏è Recommendations:</h4>
                        <ul style="margin-left: 20px; color: #78350f; line-height: 1.8;">
                            <li><strong>Maintain buffer:</strong> Keep at least 2 years of payroll in treasury</li>
                            <li><strong>Regular funding:</strong> Add funds before sustainability drops below 1 year</li>
                            <li><strong>Monitor growth:</strong> As you add employees, recalculate sustainability</li>
                            <li><strong>Current status:</strong> ${sustainabilityYears} years - ${sustainabilityYears >= 5 ? "Excellent funding! ‚úÖ" : sustainabilityYears >= 2 ? "Good, but consider adding funds soon" : "Add more funds to improve sustainability ‚ö†Ô∏è"}</li>
                        </ul>
                    </div>
                `;

                infoEl.innerHTML = html;
                showAlert('success', 'Treasury analysis complete!');

            } catch (error) {
                console.error('Error loading treasury info:', error);
                infoEl.innerHTML = `
                    <div style="padding: 20px; background: #fee; border-radius: 8px; color: #c00;">
                        <strong>Note:</strong> Treasury information shown is from last known state.<br>
                        To get real-time data, use the CLI commands:<br><br>
                        <code style="background: white; padding: 5px; border-radius: 4px; display: block; margin: 10px 0;">
                        stellar contract invoke --id salary_system --source-account alice --network testnet -- get_treasury_balance
                        </code>
                        <code style="background: white; padding: 5px; border-radius: 4px; display: block; margin: 10px 0;">
                        stellar contract invoke --id salary_system --source-account alice --network testnet -- calculate_sustainability_years
                        </code>
                    </div>
                `;
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üîÑ Reload Treasury Info';
            }
        }

        // Load Transaction History
        async function loadTransactions() {
            const btn = document.getElementById('loadTxBtn');
            const listEl = document.getElementById('transactionsList');
            
            btn.disabled = true;
            btn.innerHTML = '<span class="loading"></span> Loading...';
            listEl.innerHTML = '<p style="text-align: center; color: #888;">Fetching transactions from blockchain...</p>';

            try {
                // Fetch alice's transactions (admin who makes all contract calls)
                const ALICE_ADDRESS = 'GBPAKDYZKKXENIPOXGYCB2ZEVRQKK2JEBLPJ3CHK7MRMBZLHNPTGJAZE';
                const response = await fetch(
                    `https://horizon-testnet.stellar.org/accounts/${ALICE_ADDRESS}/transactions?limit=20&order=desc`
                );

                if (!response.ok) {
                    throw new Error('Failed to fetch transactions');
                }

                const data = await response.json();
                const transactions = data._embedded.records;

                if (transactions.length === 0) {
                    listEl.innerHTML = '<p style="text-align: center; color: #888;">No transactions found yet.</p>';
                    return;
                }

                // Fetch operation details for each transaction
                let html = '<div style="margin-bottom: 15px; padding: 15px; background: #f0f9ff; border-radius: 8px; border-left: 4px solid #0ea5e9;">';
                html += `<strong>üìä Found ${transactions.length} transactions</strong><br>`;
                html += '<span style="color: #666; font-size: 0.9em;">Recent activity from admin account (alice)</span>';
                html += '</div>';
                
                for (const tx of transactions) {
                    const date = new Date(tx.created_at);
                    const timeAgo = getTimeAgo(date);
                    
                    // Fetch operations to determine transaction type
                    let txType = 'CONTRACT CALL';
                    let txIcon = 'üìù';
                    let txColor = '#667eea';
                    
                    try {
                        const opsResponse = await fetch(tx._links.operations.href);
                        if (opsResponse.ok) {
                            const opsData = await opsResponse.json();
                            const ops = opsData._embedded.records;
                            
                            // Analyze operations to determine type
                            if (ops.some(op => op.type === 'invoke_host_function')) {
                                const memo = tx.memo || '';
                                if (memo.includes('fund') || ops[0].function?.includes('fund')) {
                                    txType = 'üí∞ FUND TREASURY';
                                    txIcon = 'üí∞';
                                    txColor = '#10b981';
                                } else if (memo.includes('add_employee') || ops[0].function?.includes('add')) {
                                    txType = '‚ûï ADD EMPLOYEE';
                                    txIcon = 'üë§';
                                    txColor = '#0ea5e9';
                                } else if (memo.includes('pay') || ops[0].function?.includes('pay')) {
                                    txType = 'üí∏ PAY SALARY';
                                    txIcon = 'üí∏';
                                    txColor = '#f59e0b';
                                } else if (memo.includes('initialize')) {
                                    txType = 'üöÄ INITIALIZE';
                                    txIcon = 'üöÄ';
                                    txColor = '#8b5cf6';
                                }
                            }
                        }
                    } catch (e) {
                        // If we can't fetch operations, just use default type
                    }
                    
                    html += `
                        <div class="transaction-card" style="border-left: 4px solid ${txColor};">
                            <div class="tx-header">
                                <span class="tx-type" style="background: ${txColor}20; color: ${txColor};">
                                    ${txIcon} ${txType}
                                </span>
                                <span class="tx-time">${timeAgo}</span>
                            </div>
                            <div style="margin: 15px 0;">
                                <strong>Transaction Hash:</strong><br>
                                <div style="display: flex; align-items: center; gap: 10px; margin-top: 5px;">
                                    <a href="https://stellar.expert/explorer/testnet/tx/${tx.hash}" 
                                       target="_blank" 
                                       class="tx-hash">${tx.hash.substring(0, 32)}...</a>
                                    <button onclick="copyToClipboard('${tx.hash}')" 
                                            style="padding: 5px 10px; font-size: 0.8em; background: #f3f4f6; border: 1px solid #ddd; border-radius: 4px; cursor: pointer;">
                                        üìã Copy
                                    </button>
                                </div>
                            </div>
                            <div class="tx-details">
                                <div><strong>üìÖ Date:</strong> ${date.toLocaleString()}</div>
                                <div><strong>‚öôÔ∏è Operations:</strong> ${tx.operation_count}</div>
                                <div><strong>üíé Fee:</strong> ${(parseFloat(tx.fee_charged) / 10000000).toFixed(7)} XLM</div>
                                <div><strong>‚úÖ Status:</strong> ${tx.successful ? '<span style="color: #10b981;">‚úÖ Successful</span>' : '<span style="color: #ef4444;">‚ùå Failed</span>'}</div>
                            </div>
                        </div>
                    `;
                }

                listEl.innerHTML = html;
                showAlert('success', `Loaded ${transactions.length} transactions from admin account`);

            } catch (error) {
                console.error('Error loading transactions:', error);
                listEl.innerHTML = `
                    <div style="padding: 20px; background: #fee; border-radius: 8px; color: #c00;">
                        <strong>Error:</strong> ${error.message}<br><br>
                        Try viewing transactions directly on 
                        <a href="https://stellar.expert/explorer/testnet/contract/${CONTRACT_ID}" 
                           target="_blank" 
                           style="color: #667eea;">Stellar Expert</a>
                    </div>
                `;
                showAlert('error', 'Failed to load transactions: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'üîÑ Reload Transactions';
            }
        }

        // Get human-readable time ago
        function getTimeAgo(date) {
            const seconds = Math.floor((new Date() - date) / 1000);
            
            const intervals = {
                year: 31536000,
                month: 2592000,
                week: 604800,
                day: 86400,
                hour: 3600,
                minute: 60,
                second: 1
            };

            for (const [unit, secondsInUnit] of Object.entries(intervals)) {
                const interval = Math.floor(seconds / secondsInUnit);
                if (interval >= 1) {
                    return `${interval} ${unit}${interval !== 1 ? 's' : ''} ago`;
                }
            }
            
            return 'Just now';
        }

        // Check for Freighter on load
        window.onload = function() {
            if (window.freighterApi) {
                showAlert('info', 'Freighter detected! Click "Connect Freighter" to get started.');
            } else {
                showAlert('info', 'Install Freighter wallet to interact with the contract.');
            }
        };
    </script>
</body>
</html>
